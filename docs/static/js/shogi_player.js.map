{"version":3,"sources":["webpack:///./src/point.js","webpack:///./src/parser_base.js","webpack:///src/components/ShogiPlayer.vue","webpack:///./src/battler.js","webpack:///./src/memory_record.js","webpack:///./src/components/piece_stand.vue?30b5","webpack:///./src/mediator.js","webpack:///./src/piece.js","webpack:///./src/components/piece_stand.vue","webpack:///./src/sfen_serializer.js","webpack:///./src/components/ShogiPlayer.vue?a01d","webpack:///./src/board.js","webpack:///./src/location.js","webpack:///src/components/piece_stand.vue","webpack:///./src/components/ShogiPlayer.vue","webpack:///./src/kif_parser.js","webpack:///./src/sfen_parser.js"],"names":["_board","__webpack_require__","Point","value","_classCallCheck3","default","this","x","y","_parse_from_string2","_parse_from_string","_parse_from_string3","_slicedToArray3","_value","_ref","_x","_y","v","_freeze2","s","_this","_s$split$map","replace","e","_replace_table","split","map","Number","_s$split$map2","Board","dimension","toString","１","２","３","４","５","６","７","８","９","一","二","三","四","五","六","七","八","九","a","b","c","d","f","g","h","i","process","argv","__filename","console","log","fetch","key","_location","ParserBase","kifu_body","header","offset","turn_min","komaochi_p","Location","warn","_map2","values","move_infos","length","_mediator","PieceStand","_piece_stand2","mediator_update","keyboard_operation","activeElement","metaKey","code","move_to_previous","preventDefault","move_to_next","Mediator","current_turn","run","current_real_turn","focus","focus_to_slide","turn_max","_point","_piece","Battler","attributes","_assign2","piece","point","location","promoted","promoted_name","name","battler","Piece","location_key","MemoryRecord","values_map","get","element","lookup","Error","_values_map","define","_values","_from2","esExports","render","_vm","_h","$createElement","_c","_self","staticClass","class","$parent","env","turn_active","mediator","location_next","_v","_s","_f","_l","ref","piece_key","count","_e","staticRenderFns","__webpack_exports__","_sfen_parser","_kif_parser","_battler3","_sfen_serializer","any_parser","current_field","hold_pieces","move_info","test","SfenParser","KifParser","parse","field","num","_lodash2","times","m","stroke_piece","set","delete","undefined","origin_point","promoted_trigger","str","klass","push","index","turn_clamp","SfenSerializer","to_s","location_by_offset","_get3","__proto__","_getPrototypeOf2","call","toUpperCase","find","alias_name","includes","promoted_alias_name","__WEBPACK_IMPORTED_MODULE_1__node_modules_vue_loader_lib_template_compiler_index_id_data_v_3d7c7146_hasScoped_true_transformToRequire_video_src_poster_source_src_img_src_image_xlink_href_buble_transforms_node_modules_vue_loader_lib_selector_type_template_index_0_piece_stand_vue__","__vue_styles__","ssrContext","Component","normalizeComponent","__WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_lib_selector_type_script_index_0_piece_stand_vue___default","parts","to_baord_sfen","to_hold_pieces","join","rows","space","toLowerCase","_this2","location_info","compact","isEmpty","sfen_serializer","enable","board_turn","attrs","on","click","$event","stopPropagation","move_to","cell_class","cell_view","move_to_first","move_to_last","directives","rawName","expression","modifiers","number","type","min","max","domProps","__r","_n","target","blur","$forceUpdate","to_sfen","__WEBPACK_IMPORTED_MODULE_1__node_modules_vue_loader_lib_template_compiler_index_id_data_v_2a63bcc4_hasScoped_true_transformToRequire_video_src_poster_source_src_img_src_image_xlink_href_buble_transforms_node_modules_vue_loader_lib_selector_type_template_index_0_ShogiPlayer_vue__","__WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_lib_selector_type_script_index_0_ShogiPlayer_vue___default","_parser_base","sfen_parser","regexp","_xregexp2","list","forEach","md","kif_lookup","kif_parser","location_base","_battler","regex","exec","__location_by_upper_or_lower_case","_this3","_hold_pieces","piece_char","_this4"],"mappings":"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","file":"static/js/shogi_player.js","sourcesContent":["import { Board } from \"./board\"\n\nclass Point {\n  static fetch(v) {\n    return Object.freeze(new Point(v))\n  }\n\n  constructor(value) {\n    let x, y\n    if (typeof value === \"string\") {\n      [x, y] = this._parse_from_string(value)\n    } else {\n      [x, y] = value\n    }\n    [this._x, this._y] = [x, y]\n  }\n\n  get key() {\n    return [this._x, this._y].toString()\n  }\n\n  get x() {\n    return this._x\n  }\n\n  get y() {\n    return this._y\n  }\n\n  _parse_from_string(s) {\n    s = s.replace(/([１-９一二三四五六七八九a-z])/g, (e) => this._replace_table[e])\n    const [x, y] = s.split(\"\").map((e) => Number(e))\n    return [Board.dimension - x, y - 1]\n  }\n\n  get _replace_table() {\n    /* eslint-disable object-property-newline, key-spacing */\n    return {\n      \"１\": 1, \"２\": 2, \"３\": 3, \"４\": 4, \"５\": 5, \"６\": 6, \"７\": 7, \"８\": 8, \"９\": 9,\n      \"一\": 1, \"二\": 2, \"三\": 3, \"四\": 4, \"五\": 5, \"六\": 6, \"七\": 7, \"八\": 8, \"九\": 9,\n      \"a\":  1, \"b\":  2, \"c\":  3, \"d\":  4, \"e\":  5, \"f\":  6, \"g\":  7, \"h\":  8, \"i\":  9,\n    }\n  }\n}\n\nexport { Point }\n\nif (process.argv[1] === __filename) {\n  console.log(Point.fetch(\"6a\").key)\n  console.log(Point.fetch([1, 2]).key)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/point.js","import { Location } from \"./location\"\n\nclass ParserBase {\n  constructor() {\n    this.kifu_body = null\n    this.header = {}\n  }\n\n  parse() {\n  }\n\n  get field() {\n    console.warn(\"not implemented\")\n  }\n\n  get hold_pieces() {\n    return new Map(Location.values.map((e) => [e.key, new Map()]))\n  }\n\n  get turn_min() {\n    return 0\n  }\n\n  get turn_max() {\n    return this.turn_min + this.move_infos.length\n  }\n\n  location_by_offset(offset) {\n    const index = this.turn_min + offset + (this.komaochi_p ? 1 : 0)\n    let key = null\n    if ((index % 2) === 0) {\n      key = \"black\"\n    } else {\n      key = \"white\"\n    }\n    return Location.fetch(key)\n  }\n\n  get move_infos() {\n    console.warn(\"not implemented\")\n  }\n}\n\nexport { ParserBase }\n\nif (process.argv[1] === __filename) {\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/parser_base.js","<template>\n<div class=\"shogi-player\">\n  <p>{{mediator.current_real_turn}}手目</p>\n  <div class=\"board_container board_turn\" :class=\"{enable: board_turn}\">\n    <PieceStand :location_key=\"'white'\"/>\n    <div class=\"flex_item board_wrap\">\n      <div class=\"overlay_navi previous\" @click.stop=\"move_to(-1)\"></div>\n      <div class=\"overlay_navi next\" @click.stop=\"move_to(1)\"></div>\n      <table>\n        <tr v-for=\"y in mediator.dimension\">\n          <template v-for=\"x in mediator.dimension\">\n            <td :class=\"mediator.cell_class(x -1, y - 1)\">\n              {{mediator.cell_view(x - 1, y - 1)}}\n            </td>\n          </template>\n        </tr>\n      </table>\n    </div>\n    <PieceStand :location_key=\"'black'\"/>\n  </div>\n  <template v-if=\"controller_show\">\n    <div class=\"sp-controllers buttons has-addons is-centered\">\n      <button ref=\"first\"    class=\"button first\"      @click.stop=\"move_to_first\">|◀</button>\n      <button ref=\"previous\" class=\"button previous\"   @click.stop=\"move_to_previous\">◀</button>\n      <button ref=\"next\"     class=\"button next\"       @click.stop=\"move_to_next\">▶</button>\n      <button ref=\"last\"     class=\"button last\"       @click.stop=\"move_to_last\">▶|</button>\n      <button                class=\"button board_turn\" @click.stop=\"board_turn = !board_turn\">{{board_turn ? '&#x21BA;' : '&#x21BB;'}}</button>\n    </div>\n  </template>\n  <template v-if=\"slider_show\">\n    <input type=\"range\" v-model.number=\"current_turn\" :min=\"mediator.any_parser.turn_min\" :max=\"mediator.any_parser.turn_max\" ref=\"slider\" />\n  </template>\n  <div v-if=\"sfen_show\">\n    {{mediator.to_sfen}}\n  </div>\n  <template v-if=\"debug_mode\">\n    <p>{{mediator.hold_pieces}}</p>\n    <p>次の手番:{{mediator.location_next.key}}</p>\n    <p>Sfen:{{mediator.to_sfen}}</p>\n  </template>\n</div>\n</template>\n\n<script>\nimport { Mediator } from \"../mediator\"\nimport PieceStand from \"./piece_stand\"\nimport _ from \"lodash\"\n\n// for vue template\n// import Vue from 'vue'\n// import lodash from \"lodash\"\n// Object.defineProperty(Vue.prototype, '$lodash', {value: lodash})\n\n/* eslint-disable no-new */\nexport default {\n  name: 'ShogiPlayer',\n\n  /* eslint-disable */\n  props: {\n    kifu_body:                { type: String,  default: \"position startpos\", },\n    turn_start:               { type: Number,  default: 0,                   },\n    global_keyboard_operation:  { type: Boolean, default: false                },\n    location_hash_embed_turn: { type: Boolean, default: false,               },\n    controller_show:          {                default: false,               },\n    slider_show:              { type: Boolean, default: false,               },\n    sfen_show:                { type: Boolean, default: false,               },\n    debug_mode:               { type: Boolean, default: false,               }, // process.env.NODE_ENV !== 'production'\n  },\n  /* eslint-enable */\n\n  components: {\n    PieceStand,\n  },\n\n  data() {\n    return {\n      current_turn: 0,\n      mediator: null,\n      board_turn: false,\n      env: process.env.NODE_ENV,\n    }\n  },\n\n  created() {\n    this.current_turn = this.turn_start || 0\n    this.mediator_update()\n    document.addEventListener(\"keydown\", this.keyboard_operation)\n  },\n\n  watch: {\n    current_turn: function () {\n      this.mediator_update()\n    },\n    kifu_body: function () {\n      this.mediator_update()\n    },\n  },\n\n  methods: {\n    keyboard_operation: function (e) {\n      if (this.env !== \"production\") {\n        console.log(document.activeElement)\n        console.log(e.shiftKey, e.ctrlKey, e.altKey, e.metaKey)\n        console.log(\"e\", e)\n        console.log(\"key\", e.key)\n        console.log(\"code\", e.code)\n      }\n\n      if (!this.global_keyboard_operation) {\n        return\n      }\n\n      const dom = document.activeElement\n      const controllers = [this.$refs.first, this.$refs.previous, this.$refs.next, this.$refs.last] // FIXME: 指定DOMの下にあるか？の方法がわかればもっと簡潔になる\n      if (!(dom === undefined || dom.tagName === \"BODY\" || _.includes(controllers, dom))) {\n        return\n      }\n\n      if (e.code === \"Backspace\" || e.code === \"ArrowUp\" || e.code === \"ArrowLeft\" || e.key === \"k\" || e.key === \"p\" || e.key === \"b\") {\n        this.move_to_previous()\n        e.preventDefault()\n      }\n\n      if (e.code === \"Space\" || e.code === \"Enter\" || e.code === \"ArrowDown\" || e.code === \"ArrowRight\" || e.key === \"j\" || e.key === \"n\" || e.key === \"f\") {\n        this.move_to_next()\n        e.preventDefault()\n      }\n\n      // let gap = null\n      // let force_value = null\n      //\n      // if (e.code === \"Space\" || e.code === \"Enter\" || e.code === \"ArrowDown\" || e.code === \"ArrowRight\" || e.key === \"j\" || e.key === \"n\" || e.key === \"f\") {\n      //   gap = 1\n      // }\n      // if (e.code === \"Backspace\" || e.code === \"ArrowUp\" || e.code === \"ArrowLeft\" || e.key === \"k\" || e.key === \"p\" || e.key === \"b\") {\n      //   gap = -1\n      // }\n      // if (e.key === \"PageUp\") {\n      //   gap = -10\n      // }\n      // if (e.key === \"PageDown\") {\n      //   gap = 10\n      // }\n      // if (e.shiftKey || e.ctrlKey || e.altKey || e.metaKey) {\n      //   if (gap) {\n      //     gap *= 10\n      //   }\n      // }\n      // if (e.key === \"[\" || e.key === \"Home\" || e.code === \"Escape\") {\n      //   force_value = this.mediator.any_parser.turn_min\n      // }\n      // if (e.key === \"]\" || e.key === \"End\") {\n      //   force_value = this.mediator.any_parser.turn_max\n      // }\n      //\n      // let v = this.current_turn\n      // if (gap !== null) {\n      //   v += gap\n      // }\n      // if (force_value !== null) {\n      //   v = force_value\n      // }\n      // if (v < this.mediator.any_parser.turn_min) {\n      //   v = this.mediator.any_parser.turn_min\n      // }\n      // if (this.mediator.any_parser.turn_max < v) {\n      //   v = this.mediator.any_parser.turn_max\n      // }\n      // this.current_turn = v\n      //\n      // if (gap !== null || force_value !== null) {\n      //   e.preventDefault()\n      // }\n    },\n\n    mediator_update() {\n      this.mediator = new Mediator()\n      this.mediator.kifu_body = this.kifu_body || \"position startpos\"\n      this.mediator.current_turn = this.current_turn\n      this.mediator.run()\n      this.current_turn = this.mediator.current_real_turn\n      if (this.location_hash_embed_turn) {\n        document.location.hash = this.current_turn\n      }\n    },\n\n    move_to(sign) {\n      if (this.board_turn) {\n        sign *= -1\n      }\n      if (sign >= 1) {\n        this.move_to_next()\n      } else {\n        this.move_to_previous()\n      }\n    },\n\n    move_to_previous() {\n      if (this.current_turn > this.mediator.any_parser.turn_min) {\n        this.current_turn--\n      }\n      if (this.$refs.previous) {\n        this.$refs.previous.focus()\n      } else {\n        this.focus_to_slide()\n      }\n    },\n\n    move_to_next() {\n      if (this.current_turn < this.mediator.any_parser.turn_max) {\n        this.current_turn++\n      }\n      if (this.$refs.next) {\n        this.$refs.next.focus()\n      } else {\n        this.focus_to_slide()\n      }\n    },\n\n    move_to_first() {\n      this.current_turn = this.mediator.any_parser.turn_min\n      if (this.$refs.first) {\n        this.$refs.first.focus()\n      } else {\n        this.focus_to_slide()\n      }\n    },\n\n    move_to_last() {\n      this.current_turn = this.mediator.any_parser.turn_max\n      if (this.$refs.last) {\n        this.$refs.last.focus()\n      } else {\n        this.focus_to_slide()\n      }\n    },\n\n    focus_to_slide() {\n      if (this.$refs.slider) {\n        this.$refs.slider.focus()\n      }\n    },\n  },\n}\n</script>\n\n<style scoped lang=\"sass\">\n  @import \"ShogiPlayer\"\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/ShogiPlayer.vue","import { Point } from './point'\nimport { Piece } from './piece'\n\nclass Battler {\n  constructor(attributes) {\n    this.attributes = Object.assign({}, attributes)\n  }\n\n  get piece() {\n    return this.attributes.piece\n  }\n\n  get point() {\n    return this.attributes.point\n  }\n\n  get location() {\n    return this.attributes.location\n  }\n\n  get promoted() {\n    return this.attributes.promoted\n  }\n\n  set promoted(v) {\n    this.attributes.promoted = v\n  }\n\n  get name() {\n    if (this.promoted) {\n      return this.piece.promoted_name\n    }\n    return this.piece.name\n  }\n}\n\nexport { Battler }\n\nif (process.argv[1] === __filename) {\n  const battler = new Battler({\n    point: new Point([1, 2]),\n    piece: Piece.fetch(\"P\"),\n    promoted: true,\n    location_key: \"white\",\n  })\n  console.log(battler.name)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/battler.js","class MemoryRecord {\n  static get define() {\n    console.warn(\"not implemented\")\n\n    return [\n      { key: \"(key_x)\", },\n      { key: \"(key_y)\", },\n    ]\n  }\n\n  static lookup(key) {\n    return this.values_map.get(key)\n  }\n\n  static fetch(key) {\n    const element = this.lookup(key)\n    if (!element) {\n      throw new Error(`Key not found: ${key}`)\n    }\n    return element\n  }\n\n  static get values_map() {\n    this._values_map = this._values_map || new Map(this.define.map((e, i) => [e.key, Object.freeze(new this(Object.assign({}, e, {code: i})))]))\n    return this._values_map\n  }\n\n  static get values() {\n    this._values = this._values || Array.from(this.values_map.values())\n    return this._values\n  }\n\n  constructor(attributes) {\n    this.attributes = attributes\n  }\n\n  get key() {\n    return this.attributes.key\n  }\n\n  get name() {\n    return this.attributes.name || this.key.toString()\n  }\n\n  get code() {\n    return this.attributes.code\n  }\n}\n\nexport { MemoryRecord }\n\nif (process.argv[1] === __filename) {\n  console.log(MemoryRecord.values)\n  console.log(MemoryRecord.lookup(\"(key_x)\").name)\n  console.log(MemoryRecord.lookup(\"(key_x)\").code)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/memory_record.js","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"flex_item piece_stand\",class:[(\"location_\" + _vm.location_key), _vm.$parent.env, {turn_active: _vm.$parent.mediator.location_next.key === _vm.location_key}]},[_c('ul',[_c('li',{staticClass:\"location_mark\"},[_vm._v(_vm._s(_vm._f(\"location_name\")(_vm.location_key)))]),_vm._v(\" \"),_vm._l((_vm.hold_pieces),function(ref){\nvar piece_key = ref[0];\nvar count = ref[1];\nreturn [_c('li',[_c('span',{staticClass:\"piece_name\"},[_vm._v(_vm._s(_vm._f(\"piece_name\")(piece_key)))]),_vm._v(\" \"),(count >= 2)?[_c('span',{staticClass:\"piece_count\"},[_vm._v(_vm._s(count))])]:_vm._e()],2)]})],2)])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-3d7c7146\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/piece_stand.vue\n// module id = Lpg5\n// module chunks = 1 2","import _ from \"lodash\"\n\nimport { SfenParser } from \"./sfen_parser\"\nimport { KifParser } from \"./kif_parser\"\nimport { Board } from \"./board\"\nimport { Point } from \"./point\"\nimport { Battler } from \"./battler\"\nimport { SfenSerializer } from \"./sfen_serializer\"\n\nclass Mediator {\n  constructor() {\n    this.any_parser = null\n    this.current_turn = null\n    this.current_field = null\n    this.hold_pieces = null\n    this.move_info = null\n\n    this.env = process.env.NODE_ENV\n    this.kifu_body = \"position startpos\"\n  }\n\n  run() {\n    if (/position/.test(this.kifu_body)) { // FIXME: この判定はしょぼい\n      this.any_parser = new SfenParser()\n    } else {\n      this.any_parser = new KifParser()\n    }\n\n    this.any_parser.kifu_body = this.kifu_body\n    this.any_parser.parse()\n\n    this.current_field = this.any_parser.field\n    this.hold_pieces = this.any_parser.hold_pieces\n    this.move_info = null\n\n    const move_infos = this.any_parser.move_infos\n\n    const num = this.current_real_turn - this.any_parser.turn_min\n    _(num).times((i) => {\n      const m = move_infos[i]\n      this.move_info = m\n      if (m.stroke_piece) {\n        const battler = new Battler({\n          piece: m.stroke_piece,\n          point: m.point,\n          promoted: m.promoted,\n          location: m.location,\n        })\n        {\n          const count = this.hold_pieces.get(m.location.key).get(battler.piece.key) - 1\n          if (count >= 1) {\n            this.hold_pieces.get(m.location.key).set(battler.piece.key, count)\n          } else {\n            this.hold_pieces.get(m.location.key).delete(battler.piece.key)\n          }\n        }\n        this.current_field.set(battler.point.key, battler)\n      } else {\n        {\n          const battler = this.current_field.get(m.point.key)\n          if (battler) {\n            if (this.hold_pieces.get(m.location.key) === undefined) {\n              this.hold_pieces.set(m.location_key, new Map())\n            }\n            const count = (this.hold_pieces.get(m.location.key).get(battler.piece.key) || 0) + 1\n            this.hold_pieces.get(m.location.key).set(battler.piece.key, count)\n          }\n        }\n        const battler = this.current_field.get(m.origin_point.key)\n        if (m.promoted_trigger) {\n          battler.promoted = true\n        }\n        this.current_field.delete(m.origin_point.key)\n        this.current_field.set(m.point.key, battler)\n      }\n    })\n  }\n\n  cell_view(x, y) {\n    const battler = this.current_field.get(Point.fetch([x, y]).key)\n    let str = \"\"\n    if (battler) {\n      str = battler.name\n    }\n    return str\n  }\n\n  cell_class(x, y) {\n    const battler = this.current_field.get(Point.fetch([x, y]).key)\n    let klass = []\n    if (battler) {\n      klass.push(`location_${battler.location.key}`)\n    }\n    if (this.move_info) {\n      const origin_point = this.move_info.origin_point\n      if (origin_point) {\n        if (origin_point.x === x && origin_point.y === y) {\n          klass.push(\"origin_point\")\n        }\n      }\n      const point = this.move_info.point\n      if (point.x === x && point.y === y) {\n        klass.push(\"current\")\n      }\n    }\n    return klass\n  }\n\n  turn_clamp(v) {\n    if (this.any_parser) {\n      if (v < this.any_parser.turn_min) {\n        v = this.any_parser.turn_min\n      }\n      if (this.any_parser.turn_max < v) {\n        v = this.any_parser.turn_max\n      }\n    }\n    return v\n  }\n\n  get dimension() {\n    return Board.dimension\n  }\n\n  // ruby style array index access\n  get current_real_turn() {\n    let index = this.current_turn\n    if (index < 0) {\n      index += this.any_parser.turn_max + 1\n    }\n    return this.turn_clamp(index)\n  }\n\n  get to_sfen() {\n    return (new SfenSerializer(this)).to_s\n  }\n\n  get location_next() {\n    return this.any_parser.location_by_offset(this.current_real_turn)\n  }\n}\n\nexport { Mediator }\n\n\n\n// WEBPACK FOOTER //\n// ./src/mediator.js","import { MemoryRecord } from \"./memory_record\"\n\nclass Piece extends MemoryRecord {\n  static get define() {\n    return [\n      { key: \"K\", name: \"玉\", alias_name: \"王\", promoted_name: null, promoted_alias_name: null, },\n      { key: \"R\", name: \"飛\", alias_name: null, promoted_name: \"龍\", promoted_alias_name: \"竜\", },\n      { key: \"B\", name: \"角\", alias_name: null, promoted_name: \"馬\", promoted_alias_name: null, },\n      { key: \"G\", name: \"金\", alias_name: null, promoted_name: null, promoted_alias_name: null, },\n      { key: \"S\", name: \"銀\", alias_name: null, promoted_name: \"全\", promoted_alias_name: null, },\n      { key: \"N\", name: \"桂\", alias_name: null, promoted_name: \"圭\", promoted_alias_name: null, },\n      { key: \"L\", name: \"香\", alias_name: null, promoted_name: \"杏\", promoted_alias_name: null, },\n      { key: \"P\", name: \"歩\", alias_name: null, promoted_name: \"と\", promoted_alias_name: null, },\n    ]\n  }\n\n  static lookup(key) {\n    return super.lookup(key.toUpperCase())\n  }\n\n  static kif_lookup(key) {\n    return this.values.find((e) => [e.name, e.alias_name].includes(key))\n  }\n\n  static kif_promoted_lookup(key) {\n    return this.values.find((e) => [e.promoted_name, e.promoted_alias_name].includes(key))\n  }\n\n  get promoted_name() {\n    return this.attributes.promoted_name\n  }\n}\n\nexport { Piece }\n\nif (process.argv[1] === __filename) {\n  console.log(Piece.fetch(\"K\"))\n  console.log(Piece.fetch(\"K\"))\n  console.log(Piece.lookup(\"\"))\n  console.log(Piece.values)\n  console.log(Piece.values_map.get(\"K\"))\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/piece.js","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-3d7c7146\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"indentedSyntax\\\":true,\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./piece_stand.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./piece_stand.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./piece_stand.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-3d7c7146\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./piece_stand.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-3d7c7146\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/piece_stand.vue\n// module id = QERr\n// module chunks = 1 2","import _ from \"lodash\"\n\nimport { Piece } from \"./piece\"\nimport { Point } from \"./point\"\nimport { Mediator } from \"./mediator\"\nimport { Location } from \"./location\"\nimport { Board } from \"./board\"\n\nclass SfenSerializer {\n  constructor(mediator) {\n    this.mediator = mediator\n  }\n\n  get to_s() {\n    const parts = []\n    parts.push(this.to_baord_sfen)\n    parts.push(this.mediator.location_next.key[0])\n    parts.push(this.to_hold_pieces)\n    parts.push(this.mediator.current_real_turn + 1)\n    return parts.join(\" \")\n  }\n\n  get to_baord_sfen() {\n    const rows = []\n    _.times(Board.dimension, (y) => {\n      let str = \"\"\n      let space = 0\n      _.times(Board.dimension, (x) => {\n        const point = Point.fetch([x, y])\n        const battler = this.mediator.current_field.get(point.key)\n        if (battler === undefined) {\n          space++\n        } else {\n          if (space >= 1) {\n            str += space\n            space = 0\n          }\n          if (battler.promoted) {\n            str += \"+\"\n          }\n          let key = battler.piece.key\n          if (battler.location.key === \"white\") {\n            key = key.toLowerCase()\n          }\n          str += key\n        }\n      })\n      if (space >= 1) {\n        str += space\n      }\n      rows.push(str)\n    })\n    return rows.join(\"/\")\n  }\n\n  get to_hold_pieces() {\n    let str = Location.values.map((location_info) => {\n      const hold_pieces = this.mediator.hold_pieces.get(location_info.key)\n      const values = Piece.values.map((e) => {\n        let count = hold_pieces.get(e.key) || 0\n        let str = \"\"\n        if (count === 0) {\n          return\n        }\n        if (count >= 2) {\n          str += count\n        }\n        let key = e.key\n        if (location_info.key === \"white\") {\n          key = key.toLowerCase()\n        } else {\n          key = key.toUpperCase()\n        }\n        str += key\n        return str\n      })\n      return _.compact(values).join(\"\")\n    }).join(\"\")\n\n    if (_.isEmpty(str)) {\n      str = \"-\"\n    }\n\n    return str\n  }\n}\n\nexport { SfenSerializer }\n\nif (process.argv[1] === __filename) {\n  const mediator = new Mediator()\n  mediator.kifu_body = \"position sfen +lnsgkgsnl/1r5b1/ppppppppp/9/9/9/PPPPPPPPP/1B5R1/LNSGKGSNL b S2s 1 moves 7i6h S*2d\"\n  mediator.current_turn = 1\n  mediator.run()\n  const sfen_serializer = new SfenSerializer(mediator)\n  console.log(sfen_serializer.to_s)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/sfen_serializer.js","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"shogi-player\"},[_c('p',[_vm._v(_vm._s(_vm.mediator.current_real_turn)+\"手目\")]),_vm._v(\" \"),_c('div',{staticClass:\"board_container board_turn\",class:{enable: _vm.board_turn}},[_c('PieceStand',{attrs:{\"location_key\":'white'}}),_vm._v(\" \"),_c('div',{staticClass:\"flex_item board_wrap\"},[_c('div',{staticClass:\"overlay_navi previous\",on:{\"click\":function($event){$event.stopPropagation();_vm.move_to(-1)}}}),_vm._v(\" \"),_c('div',{staticClass:\"overlay_navi next\",on:{\"click\":function($event){$event.stopPropagation();_vm.move_to(1)}}}),_vm._v(\" \"),_c('table',_vm._l((_vm.mediator.dimension),function(y){return _c('tr',[_vm._l((_vm.mediator.dimension),function(x){return [_c('td',{class:_vm.mediator.cell_class(x -1, y - 1)},[_vm._v(\"\\n              \"+_vm._s(_vm.mediator.cell_view(x - 1, y - 1))+\"\\n            \")])]})],2)}))]),_vm._v(\" \"),_c('PieceStand',{attrs:{\"location_key\":'black'}})],1),_vm._v(\" \"),(_vm.controller_show)?[_c('div',{staticClass:\"sp-controllers buttons has-addons is-centered\"},[_c('button',{ref:\"first\",staticClass:\"button first\",on:{\"click\":function($event){$event.stopPropagation();_vm.move_to_first($event)}}},[_vm._v(\"|◀\")]),_vm._v(\" \"),_c('button',{ref:\"previous\",staticClass:\"button previous\",on:{\"click\":function($event){$event.stopPropagation();_vm.move_to_previous($event)}}},[_vm._v(\"◀\")]),_vm._v(\" \"),_c('button',{ref:\"next\",staticClass:\"button next\",on:{\"click\":function($event){$event.stopPropagation();_vm.move_to_next($event)}}},[_vm._v(\"▶\")]),_vm._v(\" \"),_c('button',{ref:\"last\",staticClass:\"button last\",on:{\"click\":function($event){$event.stopPropagation();_vm.move_to_last($event)}}},[_vm._v(\"▶|\")]),_vm._v(\" \"),_c('button',{staticClass:\"button board_turn\",on:{\"click\":function($event){$event.stopPropagation();_vm.board_turn = !_vm.board_turn}}},[_vm._v(_vm._s(_vm.board_turn ? '↺' : '↻'))])])]:_vm._e(),_vm._v(\" \"),(_vm.slider_show)?[_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.current_turn),expression:\"current_turn\",modifiers:{\"number\":true}}],ref:\"slider\",attrs:{\"type\":\"range\",\"min\":_vm.mediator.any_parser.turn_min,\"max\":_vm.mediator.any_parser.turn_max},domProps:{\"value\":(_vm.current_turn)},on:{\"__r\":function($event){_vm.current_turn=_vm._n($event.target.value)},\"blur\":function($event){_vm.$forceUpdate()}}})]:_vm._e(),_vm._v(\" \"),(_vm.sfen_show)?_c('div',[_vm._v(\"\\n    \"+_vm._s(_vm.mediator.to_sfen)+\"\\n  \")]):_vm._e(),_vm._v(\" \"),(_vm.debug_mode)?[_c('p',[_vm._v(_vm._s(_vm.mediator.hold_pieces))]),_vm._v(\" \"),_c('p',[_vm._v(\"次の手番:\"+_vm._s(_vm.mediator.location_next.key))]),_vm._v(\" \"),_c('p',[_vm._v(\"Sfen:\"+_vm._s(_vm.mediator.to_sfen))])]:_vm._e()],2)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-2a63bcc4\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/ShogiPlayer.vue\n// module id = eQlk\n// module chunks = 1 2","class Board {\n  static get dimension() {\n    return 9\n  }\n}\n\nexport { Board }\n\nif (process.argv[1] === __filename) {\n  console.log(Board.dimension)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/board.js","import { MemoryRecord } from \"./memory_record\"\n\nclass Location extends MemoryRecord {\n  static get define() {\n    return [\n      { key: \"black\", name: '☗', },\n      { key: \"white\", name: '☖', },\n    ]\n  }\n}\n\nexport { Location }\n\nif (process.argv[1] === __filename) {\n  console.log(Location.fetch(\"black\"))\n\n  Location.values.map((e) => {\n    console.log(e)\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/location.js","<template>\n<div class=\"flex_item piece_stand\" :class=\"[`location_${location_key}`, $parent.env, {turn_active: $parent.mediator.location_next.key === location_key}]\">\n  <ul>\n    <li class=\"location_mark\">{{location_key | location_name}}</li>\n    <template v-for=\"[piece_key, count] in hold_pieces\">\n      <li>\n        <span class=\"piece_name\">{{piece_key | piece_name}}</span>\n        <template v-if=\"count >= 2\">\n          <span class=\"piece_count\">{{count}}</span>\n        </template>\n      </li>\n    </template>\n  </ul>\n</div>\n</template>\n\n<script>\nimport _ from \"lodash\"\nimport { Piece } from \"../piece\"\nimport { Location } from \"../location\"\n\nexport default {\n  props: {\n    location_key: { required: true },\n  },\n\n  computed: {\n    hold_pieces: function () {\n      let list = Array.from(this.$parent.mediator.hold_pieces.get(this.location_key))\n      list = list.filter(([key, count]) => count >= 1)\n      return _.sortBy(list, ([key, count]) => Piece.fetch(key).code)\n    },\n  },\n\n  filters: {\n    piece_name(key) {\n      return Piece.fetch(key).name\n    },\n    location_name(key) {\n      return Location.fetch(key).name\n    },\n  },\n}\n</script>\n\n<style scoped lang=\"sass\">\n@import \"variables\"\n\n.shogi-player\n  .piece_stand\n    min-width: 8vmin\n    margin: 0 1vmin\n    text-align: left\n\n    // &.development\n    //   border: 2px solid $line-color\n    //   background: $board-bg-color\n    //   border-radius: 0.5vmin\n    ul\n      list-style-type: none\n      padding: 0 0.25vmin\n      margin: 1vmin\n      li\n        // 歩(2) の並びを横軸中央で揃える\n        display: flex\n        align-items: center\n\n        // 持駒\n        color: $piece-color\n        font-size: $font-size\n\n        // 持駒数\n        .piece_count\n          vertical-align: middle\n          margin-left: 0.3rem\n          font-size: $font-size * 0.8\n\n        // 駒台の上のマーク\n        .location_mark\n\n    &.turn_active\n      // border: 2px solid $line-color\n      // background: $board-bg-color\n      // border-radius: 0.5vmin\n\n      ul\n        li.location_mark\n          text-shadow: 0 0 1.0rem hsl(120,0%,50%)\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/piece_stand.vue","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-2a63bcc4\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"indentedSyntax\\\":true,\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./ShogiPlayer.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ShogiPlayer.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ShogiPlayer.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-2a63bcc4\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./ShogiPlayer.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-2a63bcc4\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/ShogiPlayer.vue\n// module id = oS6v\n// module chunks = 1 2","import XRegExp from \"xregexp\"\n\nimport { ParserBase } from \"./parser_base\"\nimport { Piece } from \"./piece\"\nimport { Point } from \"./point\"\nimport { Location } from \"./location\"\nimport { SfenParser } from \"./sfen_parser\"\n\nclass KifParser extends ParserBase {\n  get field() {\n    const sfen_parser = new SfenParser()\n    sfen_parser.kifu_body = \"position startpos\" // TODO: sfen形式の値のテーブルを持って駒落ちに対応する\n    sfen_parser.parse()\n    return sfen_parser.field\n  }\n\n  get location_base() {\n    let key = null\n    const value = this.header[\"手合割\"] || \"平手\"\n    if (value === \"平手\") {\n      key = \"black\"\n    } else {\n      key = \"white\"\n    }\n    return Location.fetch(key)\n  }\n\n  get move_infos() {\n    const regexp = XRegExp(`\n        ^\\\\s*(?<number>\\\\d+)\\\\s+\n        (?<to>[１-９1-9一二三四五六七八九]{2})?\n        (?<same>同)?\n        (?<piece>成[銀桂香]|[王玉金銀全桂圭香杏角馬飛龍竜歩と])\n        (?<suffix>[左右直]?[寄引上]?)\n        (?<motion>不?成|打|合|生)?\n        (\\\\((?<origin_point>\\\\d{2})\\\\))? # KIFフォーマットの移動元用\n      `, 'xm')\n\n    const list = []\n    XRegExp.forEach(this.kifu_body, regexp, (md, i) => {\n      const attrs = {}\n      attrs[\"location\"] = this.location_by_offset(i)\n      if (md[\"origin_point\"]) {\n        attrs[\"origin_point\"] = Point.fetch(md[\"origin_point\"])\n      }\n      if (md[\"to\"]) {\n        attrs[\"point\"] = Point.fetch(md[\"to\"])\n      }\n      if (md[\"motion\"] === \"成\") {\n        attrs[\"promoted_trigger\"] = true\n      }\n      if (md[\"motion\"] === \"打\") {\n        attrs[\"stroke_piece\"] = Piece.kif_lookup(md[\"piece\"])\n      }\n\n      list.push(attrs)\n    })\n    return list\n  }\n}\n\nexport { KifParser }\n\nif (process.argv[1] === __filename) {\n  const kif_parser = new KifParser()\n  kif_parser.kifu_body = `\n# ----  Kifu for Windows V6.26 棋譜ファイル  ----\nkey：value\n手数----指手---------消費時間--\n*コメント0\n   1 ７六歩(77)   ( 0:00/00:00:00)\n   2 投了         ( 0:00/00:00:00)\n変化：1手\n   1 ２六歩(25)   ( 0:00/00:00:00)\n`\n  kif_parser.parse()\n  console.log(kif_parser.field)\n  console.log(kif_parser.location_base)\n  console.log(kif_parser.hold_pieces)\n  console.log(kif_parser.move_infos)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/kif_parser.js","import XRegExp from \"xregexp\"\n\nimport { ParserBase } from \"./parser_base\"\nimport { Piece } from \"./piece\"\nimport { Point } from \"./point\"\nimport { Battler } from \"./battler\"\nimport { Location } from \"./location\"\n\nclass SfenParser extends ParserBase {\n  parse() {\n    this.kifu_body = this.kifu_body.replace(/startpos/, \"sfen lnsgkgsnl/1r5b1/ppppppppp/9/9/9/PPPPPPPPP/1B5R1/LNSGKGSNL b - 1\")\n    const regex = XRegExp(\"sfen\\\\s+(?<sfen>\\\\S+)\\\\s+(?<b_or_w>\\\\S+)\\\\s+(?<hold_pieces>\\\\S+)\\\\s+(?<turn_counter_next>\\\\d+)(\\\\s+moves\\\\s+(?<moves>.*))?\")\n    this.attributes = XRegExp.exec(this.kifu_body, regex)\n    if (process.env.NODE_ENV === \"deveopment\") {\n      console.log(this.attributes)\n    }\n  }\n\n  get field() {\n    let field = new Map()\n    this.attributes[\"sfen\"].split(\"/\").forEach((e, y) => {\n      let x = 0\n      XRegExp.forEach(e, XRegExp(\"(?<promoted>\\\\+?)(?<piece>\\\\S)\"), (m, i) => {\n        if (/\\d+/.test(m.piece)) {\n          x += Number(m.piece)\n        } else {\n          const battler = new Battler({\n            point: new Point([x, y]),\n            piece: Piece.fetch(m.piece),\n            promoted: (m.promoted === \"+\"),\n            location: this.__location_by_upper_or_lower_case(m.piece),\n          })\n          field.set(battler.point.key, battler)\n          x++\n        }\n      })\n    })\n    return field\n  }\n\n  get location_base() {\n    let key = null\n    if (this.attributes[\"b_or_w\"] === \"b\") {\n      key = \"black\"\n    } else {\n      key = \"white\"\n    }\n    return Location.fetch(key)\n  }\n\n  get hold_pieces() {\n    const _hold_pieces = super.hold_pieces\n    if (this.attributes[\"hold_pieces\"] !== \"-\") {\n      XRegExp.forEach(this.attributes[\"hold_pieces\"], XRegExp(\"(?<count>\\\\d+)?(?<piece_char>\\\\S)\"), (md, i) => {\n        const piece = Piece.fetch(md.piece_char)\n        let count = Number(md.count || 1)\n        const location = this.__location_by_upper_or_lower_case(md.piece_char)\n        count += _hold_pieces.get(location.key).get(piece.key) || 0\n        _hold_pieces.get(location.key).set(piece.key, count)\n      })\n    }\n    return _hold_pieces\n  }\n\n  get turn_min() {\n    return Number(this.attributes[\"turn_counter_next\"]) - 1\n  }\n\n  get komaochi_p() {\n    return (this.turn_min % 2) === 0 && this.location_base.key === \"white\"\n  }\n\n  get move_infos() {\n    if (this.attributes[\"moves\"] === undefined) {\n      return []\n    }\n    return this.attributes[\"moves\"].split(/\\s+/).map((e, i) => {\n      const attrs = {}\n      // if (true) {\n      //   attrs[\"scene_index\"] = this.turn_min + i\n      //   attrs[\"scene_offsert\"] = i\n      // }\n      attrs[\"location\"] = this.location_by_offset(i)\n      const md = XRegExp.exec(e, XRegExp(\"(?<origin_x>\\\\S)(?<origin_y>\\\\S)(?<pos_x>\\\\S)(?<pos_y>\\\\S)(?<promoted>\\\\+?)?\"))\n      attrs[\"promoted_trigger\"] = (md.promoted === \"+\")\n      if (md[\"origin_y\"] === \"*\") {\n        attrs[\"stroke_piece\"] = Piece.fetch(md[\"origin_x\"])\n      } else {\n        attrs[\"origin_point\"] = Point.fetch(`${md[\"origin_x\"]}${md[\"origin_y\"]}`)\n      }\n      attrs[\"point\"] = Point.fetch(`${md[\"pos_x\"]}${md[\"pos_y\"]}`)\n      return attrs\n    })\n  }\n\n  __location_by_upper_or_lower_case(v) {\n    let key = null\n    if (/[A-Z]/.test(v)) {\n      key = \"black\"\n    } else {\n      key = \"white\"\n    }\n    return Location.fetch(key)\n  }\n}\n\nexport { SfenParser }\n\nif (process.argv[1] === __filename) {\n  const sfen_parser = new SfenParser()\n  sfen_parser.kifu_body = \"position sfen +lnsgkgsnl/1r5b1/ppppppppp/9/9/9/PPPPPPPPP/1B5R1/LNSGKGSNL b S2s 1 moves 7i6h S*2d\"\n  sfen_parser.parse()\n  console.log(sfen_parser.field)\n  console.log(sfen_parser.location_base.key)\n  console.log(sfen_parser.hold_pieces)\n  console.log(sfen_parser.move_infos)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/sfen_parser.js"],"sourceRoot":""}