@import "piece_image_mapping"

// 盤の影
$sp_real_board_shadow_depth: 0.05em // 大きさ
$sp_real_board_shadow_blur:  0.05em // ぼかし度合い

// 駒の影
$sp_real_piece_shadow_depth: 0.1em // 大きさ
$sp_real_piece_shadow_blur:  0.1em // ぼかし度合い

// 持った駒の影
$sp_real_hold_shadow_depth: 0.15em // 大きさ
$sp_real_hold_shadow_blur:  0.15em // ぼかし度合い

=image_shadow($x, $weight)
  filter: drop-shadow($x $x $weight rgba(0, 0, 0, 0.3))

%board_shadow
  &:after
    +image_shadow($sp_real_board_shadow_depth, $sp_real_board_shadow_blur)
  
// 駒のテクスチャ用
%piece_fore_texture
  $advance: 20%                     // 大きくするほど駒が上に移動する
  color: transparent            // テキストを消す
  // background-size: contain      // contain にすると端が欠けない
  // background-size: 50%          // 駒の大きさ contain にしとけばいい
  background-size: 80%          // 駒の大きさ contain にしとけばいい
  background-repeat: no-repeat
  &.location_black
    background-position: 50% 50% + $advance // 先手は枠の下寄り配置
  &.location_white
    background-position: 50% 50% - $advance   // 後手は枠の上寄り配置

// 選択できる駒に指定する
%dom_real_selectable
  +image_shadow($sp_real_piece_shadow_depth, $sp_real_piece_shadow_blur)
  &.holding_p
    +desktop
      opacity: 0.4  // 駒を持ち上げたので元の駒を薄くする
    +touch
      background-color: $sp_real_holding_color
      // さらに駒を持ったときは色を濃くする
      &:hover
        background-color: $sp_real_holding_color
    
  &.selectable_p
    &:hover
      // 選択できる駒だけ反応する。background プロパティをつかうと他の設定をリセットしてしまうので注意
      background-color: $sp_real_selectable_color

@keyframes real_blink
  0%
    background-color: $sp_real_current_bg1
  100%
    background-color: $sp_real_current_bg2

.shogi-player
  &.theme-real
    // 駒の種類
    &.piece_variant-a
      .piece_fore
        +piece_image_variant_a_pack
    &.piece_variant-b
      .piece_fore
        +piece_image_variant_b_pack
    
    // 駒 (あちこちにある)
    .piece_back
      @extend %dom_real_selectable
      line-height: 100%         // これで隙間ができなくなる(が、意味がよくわかってない)
      &.origin_place
        background-color: $sp_real_origin_bg
      &.current
        animation: real_blink 0.5s ease-in-out infinite alternate
      .piece_fore
        @extend %piece_fore_texture
        height: inherit // .piece_back のサイズを継承。100% としてもいい

    // 駒箱
    .piece_box
      @extend %board_shadow
      @extend %board_texture_bg
      padding: 0.25em
      max-width:  4em
      min-height: 2.5em
      font-size: 0.9em
      .piece_count
        position: relative
        top: 0.1em
        font-size: 0.4em
        margin-left: -0.3em
      
    // 駒台
    .piece_stand_outer
      .piece_stand
        @extend %board_texture_bg
        font-size: 1.3em
        padding-top:    0.15em
        padding-bottom: 0.15em
        width: 1.4em
        min-height: 3em
        li
          .piece_count
            position: relative
            top: 0.2em
            font-size: 0.4em
            margin-left: -0.3em
      
      &.location_black
        .piece_stand
          &:after
            +image_shadow($sp_real_board_shadow_depth, $sp_real_board_shadow_blur)
      &.location_white
        .piece_stand
          &:after
            +image_shadow(-$sp_real_board_shadow_depth, $sp_real_board_shadow_blur) // 相手の駒台は逆になっているため影を逆にする
          .piece_back
            @extend %is_flip   // 後手の下向きの駒が、駒台が逆になることで上に向いているため、下向きにする

    // 盤
    .board_outer
      @extend %board_shadow
      @extend %board_texture_bg
      margin: 0 $sp_real_margin
      padding: 2%               // 盤の隅の隙間
      .board_inner
        +board_star_mark_define($sp_real_grid_color)
        td
          border: $sp_real_grid_inner solid $sp_real_grid_color // 盤面の罫線
          .piece_back
            height: inherit  // td のサイズを継承。100% としてもいい
            // 画像の場合 padding-top: 0.5em は使えない
            .piece_fore
              // padding-top: 1.2em // 画像の場合使えない

    // カーソル位置に表示する持駒
    .cursor_elem
      +image_shadow($sp_real_hold_shadow_depth, $sp_real_hold_shadow_blur)
            
//////////////////////////////////////////////////////////////////////////////// valiation

=bg_variant_define($key, $file)
  &.bg_variant-#{$key}
    .board_outer, .piece_box, .piece_stand
      &:after
        background-image: url("#{$sp_assets_dir}/background/#{$file}")
        // opacity: 1.0

// (loop for i from ?a to ?z do (save-excursion (insert (format "%c" i))) (next-line))
.shogi-player
  &.theme-real
    +bg_variant_define(a, "0100_wood_01.png")
    +bg_variant_define(b, "0110_wood_02.png")
    +bg_variant_define(c, "0120_wood_03.png")
    +bg_variant_define(d, "0130_wood_04.png")
    +bg_variant_define(e, "0140_wood_05.jpg")
    +bg_variant_define(f, "0150_japanese-paper_00008.jpg")
    +bg_variant_define(g, "0160_japanese-paper_00012.jpg")
    +bg_variant_define(h, "0170_japanese-paper_00050.jpg")
    +bg_variant_define(i, "0180_japanese-paper_00055.jpg")
    +bg_variant_define(j, "0190_japanese-paper_00070.jpg")
    +bg_variant_define(k, "0200_japanese-paper_00072.jpg")
    +bg_variant_define(l, "0210_japanese-paper_00085.jpg")
    +bg_variant_define(m, "0220_japanese-paper_00122.jpg")
    +bg_variant_define(n, "0230_japanese-paper_00128.jpg")
    +bg_variant_define(o, "0240_japanese-paper_xxxxx.png")
    +bg_variant_define(p, "0250_paper_co_cyan_papar.png")
    +bg_variant_define(q, "0260_paper_co_white_paper.png")
    +bg_variant_define(r, "0270_cherry_blossom.png")
    +bg_variant_define(s, "0280_fire.png")
    +bg_variant_define(t, "0290_forest_gray.png")
    +bg_variant_define(u, "0300_forest_green.png")
    +bg_variant_define(v, "0310_sky_01.png")
    +bg_variant_define(w, "0320_sky_02.png")
    +bg_variant_define(x, "0330_sky_03.png")
    +bg_variant_define(y, "0340_water_01.png")
    +bg_variant_define(z, "0350_water_02.png")
