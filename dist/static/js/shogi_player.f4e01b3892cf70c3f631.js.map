{"version":3,"sources":["webpack:///./src/point.js","webpack:///./src/parser_base.js","webpack:///src/components/ShogiPlayer.vue","webpack:///./src/battler.js","webpack:///./src/memory_record.js","webpack:///./src/mediator.js","webpack:///./src/piece.js","webpack:///./src/sfen_serializer.js","webpack:///./src/components/ShogiPlayer.vue?2d46","webpack:///./src/components/PieceStand.vue?285e","webpack:///./src/components/PieceStand.vue","webpack:///./src/board.js","webpack:///./src/location.js","webpack:///./src/components/ShogiPlayer.vue","webpack:///./src/kif_parser.js","webpack:///src/components/PieceStand.vue","webpack:///./src/sfen_parser.js"],"names":["_board","__webpack_require__","Point","value","_classCallCheck3","default","this","x","y","_parse_from_string2","_parse_from_string","_parse_from_string3","_slicedToArray3","_value","_ref","_x","_y","v","_freeze2","s","_this","_s$split$map","replace","e","_replace_table","split","map","Number","_s$split$map2","Board","dimension","toString","１","２","３","４","５","６","７","８","９","一","二","三","四","五","六","七","八","九","a","b","c","d","f","g","h","i","process","argv","__filename","console","log","fetch","key","_location","ParserBase","kifu_body","header","offset","turn_min","komaochi_p","Location","warn","_map2","values","move_infos","length","_mediator","Object","defineProperty","_vue2","prototype","_lodash2","debug","_response","headers","config","url","_error","logger_debug","PieceStand","_PieceStand2","kifu_read","polling_interval_update","mediator_update","keyboard_operation","turn_edit_value","polling","arguments","undefined","__kifu_read_from_url","read_counter","kifu_url","accessd_at","then","response","data","status","statusText","request","message","_this2","interval_id","Mediator","loaded_kifu","current_turn","run","normalized_turn","activeElement","metaKey","code","preventDefault","event","shift_key_mag","system_key_mag","new_val","turn_max","focus","board_turn","_this3","_point","_piece","Battler","attributes","_assign2","piece","point","location","promoted","promoted_name","name","battler","Piece","location_key","MemoryRecord","values_map","get","element","lookup","Error","_values_map","define","_values","_from2","_sfen_parser","_kif_parser","_battler3","_sfen_serializer","any_parser","current_field","hold_pieces","move_info","env","str","test","SfenParser","KifParser","parse","field","num","times","m","stroke_piece","count","set","delete","origin_point","promoted_trigger","cell_lookup","list","push","concat","css_class_list","index","clamp","_autolinker2","link","filter","_ref2","_ref3","_ref4","sortBy","_ref5","_ref6","turn_clamp","location_by_offset","SfenSerializer","to_s","comments_pack","location_current","toUpperCase","_get3","__proto__","_getPrototypeOf2","call","find","alias_name","includes","promoted_alias_name","mediator","parts","to_baord_sfen","location_next","to_hold_pieces","join","rows","space","toLowerCase","location_info","compact","isEmpty","sfen_serializer","esExports","render","_vm","_h","$createElement","_c","_self","staticClass","class","theme","debug_mode","directives","rawName","error_message","expression","_m","_v","_s","_e","turn_edit","on","click","turn_edit_run","current_turn_label","modifiers","number","ref","attrs","type","domProps","blur","$event","$forceUpdate","input","target","composing","_n","turned","stopPropagation","navi_relative_move","board_turn_run","_l","cell_class","cell_view","move_to_first","relative_move","move_to_last","min","max","__r","_","innerHTML","auto_link","to_sfen","staticRenderFns","__webpack_exports__","$parent","turn_active","realized_hold_pieces_of","__WEBPACK_IMPORTED_MODULE_1__node_modules_vue_loader_lib_template_compiler_index_id_data_v_f8d796fa_hasScoped_false_transformToRequire_video_src_poster_source_src_img_src_image_xlink_href_buble_transforms_node_modules_vue_loader_lib_selector_type_template_index_0_PieceStand_vue__","Component","normalizeComponent","__WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_lib_selector_type_script_index_0_PieceStand_vue___default","__WEBPACK_IMPORTED_MODULE_1__node_modules_vue_loader_lib_template_compiler_index_id_data_v_55727709_hasScoped_false_transformToRequire_video_src_poster_source_src_img_src_image_xlink_href_buble_transforms_node_modules_vue_loader_lib_selector_type_template_index_0_ShogiPlayer_vue__","__vue_styles__","ssrContext","__WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_lib_selector_type_script_index_0_ShogiPlayer_vue___default","_parser_base","before_point","forEach","line","md","_xregexp2","exec","__kif_format_move_regexp","_minimalisticAssert2","kif_lookup","sfen_parser","_move_infos","_comments_pack","kif_parser","_battler","regex","__location_by_upper_or_lower_case","_hold_pieces","piece_char","location_base","_this4"],"mappings":"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","file":"static/js/shogi_player.f4e01b3892cf70c3f631.js","sourcesContent":["import { Board } from \"./board\"\n\nclass Point {\n  static fetch(v) {\n    return Object.freeze(new Point(v))\n  }\n\n  constructor(value) {\n    let x, y\n    if (typeof value === \"string\") {\n      [x, y] = this._parse_from_string(value)\n    } else {\n      [x, y] = value\n    }\n    [this._x, this._y] = [x, y]\n  }\n\n  get key() {\n    return [this._x, this._y].toString()\n  }\n\n  get x() {\n    return this._x\n  }\n\n  get y() {\n    return this._y\n  }\n\n  _parse_from_string(s) {\n    s = s.replace(/([１-９一二三四五六七八九a-z])/g, (e) => this._replace_table[e])\n    const [x, y] = s.split(\"\").map((e) => Number(e))\n    return [Board.dimension - x, y - 1]\n  }\n\n  get _replace_table() {\n    /* eslint-disable object-property-newline, key-spacing */\n    return {\n      \"１\": 1, \"２\": 2, \"３\": 3, \"４\": 4, \"５\": 5, \"６\": 6, \"７\": 7, \"８\": 8, \"９\": 9,\n      \"一\": 1, \"二\": 2, \"三\": 3, \"四\": 4, \"五\": 5, \"六\": 6, \"七\": 7, \"八\": 8, \"九\": 9,\n      \"a\":  1, \"b\":  2, \"c\":  3, \"d\":  4, \"e\":  5, \"f\":  6, \"g\":  7, \"h\":  8, \"i\":  9,\n    }\n  }\n}\n\nexport { Point }\n\nif (process.argv[1] === __filename) {\n  console.log(Point.fetch(\"6a\").key)\n  console.log(Point.fetch([1, 2]).key)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/point.js","import { Location } from \"./location\"\n\nclass ParserBase {\n  constructor() {\n    this.kifu_body = null\n    this.header = {}\n  }\n\n  parse() {\n  }\n\n  get field() {\n    console.warn(\"not implemented\")\n  }\n\n  get hold_pieces() {\n    return new Map(Location.values.map((e) => [e.key, new Map()]))\n  }\n\n  get turn_min() {\n    return 0\n  }\n\n  get turn_max() {\n    return this.turn_min + this.move_infos.length\n  }\n\n  location_by_offset(offset) {\n    const index = this.turn_min + offset + (this.komaochi_p ? 1 : 0)\n    let key = null\n    if ((index % 2) === 0) {\n      key = \"black\"\n    } else {\n      key = \"white\"\n    }\n    return Location.fetch(key)\n  }\n\n  get move_infos() {\n    console.warn(\"not implemented\")\n  }\n\n  get comments_pack() {\n    return null\n  }\n}\n\nexport { ParserBase }\n\nif (process.argv[1] === __filename) {\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/parser_base.js","<template>\n<div class=\"shogi-player\" :class=\"[`theme-${theme}`, {debug: debug_mode}]\">\n  <!-- template v-if だとテスト時のみエラーになるため div v-show 形式にしている -->\n  <!-- これは jest の問題なのか vue の不具合なのかわからない  -->\n  <div v-show=\"error_message !== null\">\n    <div class=\"columns\">\n      <div class=\"column\">\n        <article class=\"message is-danger has-text-left\">\n          <div class=\"message-header\">\n            <p>ERROR</p>\n          </div>\n          <div class=\"message-body\">\n            <p>{{error_message}}></p>\n          </div>\n        </article>\n      </div>\n    </div>\n  </div>\n\n  <template v-if=\"!mediator\">\n    <i class=\"fas fa-spinner fa-pulse\"></i>\n  </template>\n\n  <template v-if=\"mediator\">\n    <div class=\"turn_editor\">\n      <template v-if=\"!turn_edit\">\n        <span class=\"turn_edit_text\" @click=\"turn_edit_run\">{{mediator.current_turn_label}}</span>\n      </template>\n      <template v-if=\"turn_edit\">\n        <input type=\"number\" v-model.number=\"turn_edit_value\" @blur=\"turn_edit = false\" ref=\"turn_edit_input\" class=\"turn_edit_input\">\n      </template>\n    </div>\n    <div class=\"board_container board_turn\" :class=\"{turned: board_turn}\">\n      <PieceStand :location_key=\"'white'\"/>\n      <div class=\"flex_item board_wrap\">\n        <div class=\"overlay_navi previous\" @click.stop=\"navi_relative_move(-1, $event)\"></div>\n        <div class=\"overlay_navi next\"     @click.stop=\"navi_relative_move(+1, $event)\"></div>\n        <div class=\"overlay_navi board_turn_area\" @click=\"board_turn_run\"></div>\n        <table class=\"board\">\n          <tr v-for=\"y in mediator.dimension\">\n            <template v-for=\"x in mediator.dimension\">\n              <td class=\"td_cell\" :class=\"mediator.cell_class(x -1, y - 1)\">\n                <span class=\"span_cell\" :class=\"mediator.cell_class(x - 1, y - 1)\">\n                  {{mediator.cell_view(x - 1, y - 1)}}\n                </span>\n              </td>\n            </template>\n          </tr>\n        </table>\n      </div>\n      <PieceStand :location_key=\"'black'\"/>\n    </div>\n    <template v-if=\"controller_show\">\n      <div class=\"controller_block buttons has-addons is-centered\">\n        <button ref=\"first\"    class=\"button first\"      @click.stop=\"move_to_first\">|◀</button>\n        <button ref=\"previous\" class=\"button previous\"   @click.stop=\"relative_move(-1, $event)\">◀</button>\n        <button ref=\"next\"     class=\"button next\"       @click.stop=\"relative_move(+1, $event)\">▶</button>\n        <button ref=\"last\"     class=\"button last\"       @click.stop=\"move_to_last\">▶|</button>\n        <button                class=\"button board_turn\" @click.stop=\"board_turn_run\">{{board_turn ? '&#x21BA;' : '&#x21BB;'}}</button>\n      </div>\n    </template>\n\n    <template v-if=\"slider_show\">\n      <input type=\"range\" v-model.number=\"current_turn\" :min=\"mediator.any_parser.turn_min\" :max=\"mediator.any_parser.turn_max\" ref=\"slider\" class=\"slider\" />\n    </template>\n\n    <div class=\"comment_area\" v-if=\"mediator.any_parser.comments_pack\">\n      <template v-if=\"mediator.current_comments\">\n        <div class=\"columns\">\n          <div class=\"column is-three-fifths is-offset-one-fifth\">\n            <div class=\"content has-text-left\">\n              <template v-for=\"str in mediator.current_comments\">\n                <template v-if=\"_.isEmpty(str)\">\n                  <br>\n                </template>\n                <template v-else>\n                  <div v-html=\"mediator.auto_link(str)\"></div>\n                </template>\n              </template>\n            </div>\n          </div>\n        </div>\n      </template>\n    </div>\n\n    <p class=\"is-size-7 has-text-grey\" v-if=\"sfen_show\">\n      {{mediator.to_sfen}}\n    </p>\n  </template>\n\n  <template v-if=\"debug_mode\">\n    <template v-if=\"mediator\">\n      <p>{{mediator.hold_pieces}}</p>\n      <p>次の手番:{{mediator.location_next.key}}</p>\n      <p>Sfen:{{mediator.to_sfen}}</p>\n    </template>\n    <p>read_counter: {{read_counter}}</p>\n  </template>\n</div>\n</template>\n\n<script>\nimport _ from \"lodash\"\nimport axios from \"axios\"\nimport Vue from 'vue'\n\nimport { Mediator } from \"../mediator\"\nimport PieceStand from \"./PieceStand\"\n\n// To use lodash's _ in the vue template\nObject.defineProperty(Vue.prototype, '_', {value: _})\n\n// Log content type\n// localStorage.debug = \"axios\"\nrequire('axios-debug-log')({\n  request: function (debug, config) {\n    debug('Request with ' + config.headers['content-type'])\n  },\n  response: function (debug, response) {\n    debug(\n      'Response with ' + response.headers['content-type'],\n      'from ' + response.config.url\n    )\n  },\n  error: function (debug, error) {\n    // Read https://www.npmjs.com/package/axios#handling-errors for more info\n    debug('Boom', error)\n  }\n})\n\nconst logger_debug = require('debug')('debug')\n\n/* eslint-disable no-new */\nexport default {\n  name: 'ShogiPlayer',\n\n  /* eslint-disable */\n  props: {\n    kifu_body:          { type: String,  default: \"position startpos\", },\n    kifu_url:           { type: String,  default: null,                },\n    polling_interval:   { type: Number,  default: 0,                   },\n    last_after_polling: { type: Boolean, default: true,                },\n    turn_start:         { type: Number,  default: 0,                   },\n    slider_show:        { type: Boolean, default: false,               },\n    controller_show:    { type: Boolean, default: false,               },\n    sfen_show:          { type: Boolean, default: false,               },\n    key_event_capture:  { type: Boolean, default: false                },\n    url_embed_turn:     { type: Boolean, default: false,               },\n    shift_key_mag:      { type: Number,  default: 10,                  },\n    system_key_mag:     { type: Number,  default: 50,                  },\n    theme:              { type: String,  default: \"simple\",            },\n    debug_mode:         { type: Boolean, default: false,               }, // process.env.NODE_ENV !== 'production'\n  },\n  /* eslint-enable */\n\n  components: {\n    PieceStand,\n  },\n\n  data() {\n    return {\n      current_turn: this.turn_start, // N手目\n      turn_edit_value: null,         // numberフィールドで current_turn を直接操作すると空にしたとき補正値 0 に変換されて使いづらいため別にする。あと -1 のときの挙動もわかりやすい。\n      mediator: null,                // 局面管理\n      board_turn: false,             // 反転したか？\n      turn_edit: false,              // N手目編集中\n      env: process.env.NODE_ENV,\n      polling_id: null,\n      loaded_kifu: null,\n      error_message: null,\n      interval_id: null,\n      read_counter: 0,\n    }\n  },\n\n  created() {\n    this.kifu_read()\n    this.polling_interval_update()\n    this.mediator_update()\n    document.addEventListener(\"keydown\", this.keyboard_operation)\n  },\n\n  watch: {\n    current_turn: function () {\n      this.mediator_update()\n    },\n    turn_edit_value: function () {\n      this.current_turn = this.turn_edit_value\n    },\n\n    /* eslint-disable */\n    kifu_url:  function () { this.kifu_read() },\n    kifu_body: function () { this.kifu_read() },\n    loaded_kifu: function () {\n      this.mediator_update()\n    },\n    polling_interval: function () { this.polling_interval_update() },\n    /* eslint-enable */\n\n    // 引数は親が「変更」したときがトリガー\n    debug_mode: function (v) {\n      this.log(`watch debug_mode: ${v}`)\n    },\n  },\n\n  methods: {\n    kifu_read(polling = false) {\n      if (this.kifu_url) {\n        this.__kifu_read_from_url()\n      } else {\n        this.loaded_kifu = this.kifu_body\n      }\n      this.read_counter++\n      this.log(`read_counter: ${this.read_counter}`)\n      if (polling) {\n        if (this.last_after_polling) {\n          this.current_turn = -1\n        }\n      }\n    },\n\n    __kifu_read_from_url() {\n      const url = this.kifu_url\n      // const url = \"http://localhost:3000/wr/hanairobiyori-ispt-20171104_220810.kif\"\n      // const url = \"http://tk2-221-20341.vs.sakura.ne.jp/shogi/wr/ureshino_friend-doglong-20180122_213544.kif\"\n      const accessd_at = Date.now().toString()\n      axios.get(url, {\n        params: {\"accessd_at\": accessd_at},\n        responseType: \"text\",\n        timeout: 1000 * 3,\n        headers: {\"X-SHOGI-PLAYER-TIMESTAMP\": accessd_at},\n      }).then((response) => {\n        this.loaded_kifu = response.data\n        this.error_message = null\n      }).catch((error) => {\n        if (error.response) {\n          logger_debug(\"error.response.data: %o\", error.response.data)\n          logger_debug(\"error.response.status: %o\", error.response.status)\n          logger_debug(\"error.response.statusText: %o\", error.response.statusText)\n          logger_debug(\"error.response.headers: %o\", error.response.headers)\n        } else if (error.request) {\n          logger_debug(\"error.request: %o\", error.request)\n        } else {\n          logger_debug('error.message: %o', error.message)\n        }\n        logger_debug('error.config: %o', error.config)\n\n        this.loaded_kifu = null\n        this.error_message = error.message\n      })\n    },\n\n    polling_interval_update() {\n      if (this.polling_interval >= 1) {\n        if (this.interval_id) {\n          this.log(`clearInterval(${this.interval_id})`)\n          clearInterval(this.interval_id)\n        }\n        this.interval_id = setInterval(() => { this.kifu_read(true) }, this.polling_interval * 1000)\n        this.log(`setInterval() => ${this.interval_id}`)\n      }\n    },\n\n    mediator_update() {\n      if (this.loaded_kifu) {\n        this.mediator = new Mediator()\n        this.mediator.kifu_body = this.loaded_kifu\n        this.mediator.current_turn = this.current_turn\n        this.mediator.run()\n        this.current_turn = this.mediator.normalized_turn\n        if (this.url_embed_turn) {\n          document.location.hash = this.current_turn\n        }\n      }\n    },\n\n    keyboard_operation(e) {\n      if (this.debug_mode) {\n        this.log(document.activeElement)\n        this.log(e.shiftKey, e.ctrlKey, e.altKey, e.metaKey)\n        this.log(\"e\", e)\n        this.log(\"key\", e.key)\n        this.log(\"code\", e.code)\n      }\n\n      if (!this.key_event_capture) {\n        return\n      }\n\n      const dom = document.activeElement\n      const controllers = [this.$refs.first, this.$refs.previous, this.$refs.next, this.$refs.last] // FIXME: 指定DOMの下にあるか？の方法がわかればもっと簡潔になる\n      if (!(dom === undefined || dom.tagName === \"BODY\" || _.includes(controllers, dom))) {\n        return\n      }\n\n      if (e.code === \"Backspace\" || e.code === \"ArrowUp\" || e.code === \"ArrowLeft\" || e.key === \"k\" || e.key === \"p\" || e.key === \"b\") {\n        this.relative_move(-1, e)\n        e.preventDefault()\n      }\n\n      if (e.code === \"Space\" || e.code === \"Enter\" || e.code === \"ArrowDown\" || e.code === \"ArrowRight\" || e.key === \"j\" || e.key === \"n\" || e.key === \"f\") {\n        this.relative_move(1, e)\n        e.preventDefault()\n      }\n\n      // let gap = null\n      // let force_value = null\n      //\n      // if (e.code === \"Space\" || e.code === \"Enter\" || e.code === \"ArrowDown\" || e.code === \"ArrowRight\" || e.key === \"j\" || e.key === \"n\" || e.key === \"f\") {\n      //   gap = 1\n      // }\n      // if (e.code === \"Backspace\" || e.code === \"ArrowUp\" || e.code === \"ArrowLeft\" || e.key === \"k\" || e.key === \"p\" || e.key === \"b\") {\n      //   gap = -1\n      // }\n      // if (e.key === \"PageUp\") {\n      //   gap = -10\n      // }\n      // if (e.key === \"PageDown\") {\n      //   gap = 10\n      // }\n      // if (e.shiftKey || e.ctrlKey || e.altKey || e.metaKey) {\n      //   if (gap) {\n      //     gap *= 10\n      //   }\n      // }\n      // if (e.key === \"[\" || e.key === \"Home\" || e.code === \"Escape\") {\n      //   force_value = this.mediator.any_parser.turn_min\n      // }\n      // if (e.key === \"]\" || e.key === \"End\") {\n      //   force_value = this.mediator.any_parser.turn_max\n      // }\n      //\n      // let v = this.current_turn\n      // if (gap !== null) {\n      //   v += gap\n      // }\n      // if (force_value !== null) {\n      //   v = force_value\n      // }\n      // if (v < this.mediator.any_parser.turn_min) {\n      //   v = this.mediator.any_parser.turn_min\n      // }\n      // if (this.mediator.any_parser.turn_max < v) {\n      //   v = this.mediator.any_parser.turn_max\n      // }\n      // this.current_turn = v\n      //\n      // if (gap !== null || force_value !== null) {\n      //   e.preventDefault()\n      // }\n    },\n\n    navi_relative_move(v, event) {\n      this.relative_move(v * this.board_turn_sign(), event)\n    },\n\n    relative_move(v, event = null) {\n      if (event) {\n        if (event.shiftKey) {\n          if (this.shift_key_mag) {\n            v *= this.shift_key_mag\n          }\n        }\n        if (event.ctrlKey || event.altKey || event.metaKey) {\n          if (this.system_key_mag) {\n            v *= this.system_key_mag\n          }\n        }\n      }\n\n      const new_val = this.mediator.turn_clamp(this.current_turn + v)\n      if (this.current_turn !== new_val) {\n        this.current_turn = new_val\n      }\n      if (this.debug_mode) {\n        this.log([v, new_val, this.current_turn])\n      }\n      if (!this.focus_to(\"slider\")) {\n        if (v > 0) {\n          this.focus_to(\"next\")\n        } else {\n          this.focus_to(\"previous\")\n        }\n      }\n    },\n\n    move_to_first() {\n      this.current_turn = this.mediator.any_parser.turn_min\n      this.focus_to(\"slider\") || this.focus_to(\"first\")\n    },\n\n    move_to_last() {\n      this.current_turn = this.mediator.any_parser.turn_max\n      this.focus_to(\"slider\") || this.focus_to(\"last\")\n    },\n\n    focus_to(key) {\n      const el = this.$refs[key]\n      if (el) {\n        el.focus()\n        return true\n      }\n      return false\n    },\n\n    board_turn_run() {\n      this.board_turn = !this.board_turn\n      this.focus_to(\"slider\")\n    },\n\n    turn_edit_run() {\n      this.turn_edit = true\n      this.turn_edit_value = this.current_turn\n      this.$nextTick(() => this.$refs.turn_edit_input.focus())\n    },\n\n    board_turn_sign() {\n      return this.board_turn ? -1 : 1\n    },\n\n    log(v) {\n      if (this.debug_mode) {\n        console.log(v)\n      }\n    },\n  },\n}\n</script>\n\n<style lang=\"sass\">\n@import \"./ShogiPlayer\"\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/ShogiPlayer.vue","import { Point } from './point'\nimport { Piece } from './piece'\n\nclass Battler {\n  constructor(attributes) {\n    this.attributes = Object.assign({}, attributes)\n  }\n\n  get piece() {\n    return this.attributes.piece\n  }\n\n  get point() {\n    return this.attributes.point\n  }\n\n  get location() {\n    return this.attributes.location\n  }\n\n  get promoted() {\n    return !!this.attributes.promoted\n  }\n\n  set promoted(v) {\n    this.attributes.promoted = v\n  }\n\n  get name() {\n    if (this.promoted) {\n      return this.piece.promoted_name\n    }\n    return this.piece.name\n  }\n}\n\nexport { Battler }\n\nif (process.argv[1] === __filename) {\n  const battler = new Battler({\n    point: new Point([1, 2]),\n    piece: Piece.fetch(\"P\"),\n    promoted: true,\n    location_key: \"white\",\n  })\n  console.log(battler.name)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/battler.js","class MemoryRecord {\n  static get define() {\n    console.warn(\"not implemented\")\n\n    return [\n      { key: \"(key_x)\", },\n      { key: \"(key_y)\", },\n    ]\n  }\n\n  static lookup(key) {\n    if (key instanceof this) {\n      return key\n    }\n    return this.values_map.get(key)\n  }\n\n  static fetch(key) {\n    const element = this.lookup(key)\n    if (!element) {\n      throw new Error(`Key not found: ${key}`)\n    }\n    return element\n  }\n\n  static get values_map() {\n    this._values_map = this._values_map || new Map(this.define.map((e, i) => [e.key, Object.freeze(new this(Object.assign({}, e, {code: i})))]))\n    return this._values_map\n  }\n\n  static get values() {\n    this._values = this._values || Array.from(this.values_map.values())\n    return this._values\n  }\n\n  constructor(attributes) {\n    this.attributes = attributes\n  }\n\n  get key() {\n    return this.attributes.key\n  }\n\n  get name() {\n    return this.attributes.name || this.key.toString()\n  }\n\n  get code() {\n    return this.attributes.code\n  }\n}\n\nexport { MemoryRecord }\n\nif (process.argv[1] === __filename) {\n  console.log(MemoryRecord.values)\n  console.log(MemoryRecord.lookup(\"(key_x)\").name)\n  console.log(MemoryRecord.lookup(\"(key_x)\").code)\n\n  let v = MemoryRecord.lookup(\"(key_x)\")\n  console.log(v instanceof MemoryRecord)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/memory_record.js","import _ from \"lodash\"\n\nimport { SfenParser } from \"./sfen_parser\"\nimport { KifParser } from \"./kif_parser\"\nimport { Board } from \"./board\"\nimport { Point } from \"./point\"\nimport { Piece } from \"./piece\"\nimport { Battler } from \"./battler\"\nimport { SfenSerializer } from \"./sfen_serializer\"\nimport Autolinker from 'autolinker'\n\nclass Mediator {\n  constructor() {\n    this.any_parser = null\n    this.current_turn = null\n    this.current_field = null\n    this.hold_pieces = null\n    this.move_info = null\n\n    this.env = process.env.NODE_ENV\n    this.kifu_body = \"position startpos\"\n  }\n\n  run() {\n    let str = this.kifu_body || \"position startpos\"\n    if (/position/.test(str)) { // FIXME: この判定はしょぼい\n      this.any_parser = new SfenParser()\n    } else {\n      this.any_parser = new KifParser()\n    }\n    this.any_parser.kifu_body = str\n    this.any_parser.parse()\n\n    this.current_field = this.any_parser.field\n    this.hold_pieces = this.any_parser.hold_pieces\n    this.move_info = null\n\n    const move_infos = this.any_parser.move_infos\n\n    const num = this.normalized_turn - this.any_parser.turn_min\n    _(num).times((i) => {\n      const m = move_infos[i]\n      this.move_info = m\n      if (m.stroke_piece) {\n        const battler = new Battler({\n          piece: m.stroke_piece,\n          point: m.point,\n          promoted: m.promoted,\n          location: m.location,\n        })\n        {\n          const count = this.hold_pieces.get(m.location.key).get(battler.piece.key) - 1\n          if (count >= 1) {\n            this.hold_pieces.get(m.location.key).set(battler.piece.key, count)\n          } else {\n            this.hold_pieces.get(m.location.key).delete(battler.piece.key)\n          }\n        }\n        this.current_field.set(battler.point.key, battler)\n      } else {\n        {\n          const battler = this.current_field.get(m.point.key)\n          if (battler) {\n            if (this.hold_pieces.get(m.location.key) === undefined) {\n              this.hold_pieces.set(m.location_key, new Map())\n            }\n            const count = (this.hold_pieces.get(m.location.key).get(battler.piece.key) || 0) + 1\n            this.hold_pieces.get(m.location.key).set(battler.piece.key, count)\n          }\n        }\n        const battler = this.current_field.get(m.origin_point.key)\n        if (m.promoted_trigger) {\n          battler.promoted = true\n        }\n        this.current_field.delete(m.origin_point.key)\n        this.current_field.set(m.point.key, battler)\n      }\n    })\n  }\n\n  cell_lookup(x, y) {\n    return this.current_field.get(Point.fetch([x, y]).key)\n  }\n\n  cell_class(x, y) {\n    const battler = this.cell_lookup(x, y)\n    let list = []\n    if (battler) {\n      list.push(`location_${battler.location.key}`)\n      list.push(`promoted_${battler.promoted}`)\n      list = _.concat(list, battler.piece.css_class_list)\n    } else {\n      list.push(\"blank\")\n    }\n    if (this.move_info) {\n      const origin_point = this.move_info.origin_point\n      if (origin_point) {\n        if (origin_point.x === x && origin_point.y === y) {\n          list.push(\"origin_point\")\n        }\n      }\n      const point = this.move_info.point\n      if (point.x === x && point.y === y) {\n        list.push(\"current\")\n      }\n    }\n    return list\n  }\n\n  cell_piece_class(x, y) {\n    const battler = this.cell_lookup(x, y)\n    let list = []\n    if (battler) {\n      list.push(`location_${battler.location.key}`)\n    }\n    return list\n  }\n\n  cell_view(x, y) {\n    const battler = this.cell_lookup(x, y)\n    let str = \"\"\n    if (battler) {\n      str = battler.name\n    }\n    return str\n  }\n\n  get dimension() {\n    return Board.dimension\n  }\n\n  // ruby style array index access\n  get normalized_turn() {\n    let index = Number(this.current_turn)\n    if (index < 0) {\n      index += this.any_parser.turn_max + 1\n    }\n    return this.turn_clamp(index)\n  }\n\n  turn_clamp(index) {\n    return _.clamp(Number(index), this.any_parser.turn_min, this.any_parser.turn_max)\n  }\n\n  get location_current() {\n    return this.any_parser.location_by_offset(this.normalized_turn - 1)\n  }\n\n  get location_next() {\n    return this.any_parser.location_by_offset(this.normalized_turn)\n  }\n\n  get to_sfen() {\n    return (new SfenSerializer(this)).to_s\n  }\n\n  get current_comments() {\n    if (this.any_parser.comments_pack) {\n      return this.any_parser.comments_pack[this.normalized_turn]\n    }\n  }\n\n  auto_link(v) {\n    const autolinker = new Autolinker()\n    return autolinker.link(v)\n  }\n\n  get current_turn_label() {\n    if (this.normalized_turn === this.any_parser.turn_max) {\n      return `まで${this.normalized_turn}手で${this.location_current.name}の勝ち`\n    } else {\n      return `${this.normalized_turn}手目`\n    }\n  }\n\n  realized_hold_pieces_of(location_key) {\n    const list = Array.from(this.hold_pieces.get(location_key))\n    return _(list)\n      .filter(([key, count]) => count >= 1)\n      .map(([key, count]) => [Piece.fetch(key), count])\n      .sortBy(list, ([key, count]) => key.code)\n      .value()\n  }\n}\n\nexport { Mediator }\n\n\n\n// WEBPACK FOOTER //\n// ./src/mediator.js","import { MemoryRecord } from \"./memory_record\"\n\nclass Piece extends MemoryRecord {\n  static get define() {\n    return [\n      { key: \"K\", name: \"玉\", alias_name: \"王\", promoted_name: null, promoted_alias_name: null, },\n      { key: \"R\", name: \"飛\", alias_name: null, promoted_name: \"龍\", promoted_alias_name: \"竜\", },\n      { key: \"B\", name: \"角\", alias_name: null, promoted_name: \"馬\", promoted_alias_name: null, },\n      { key: \"G\", name: \"金\", alias_name: null, promoted_name: null, promoted_alias_name: null, },\n      { key: \"S\", name: \"銀\", alias_name: null, promoted_name: \"全\", promoted_alias_name: null, },\n      { key: \"N\", name: \"桂\", alias_name: null, promoted_name: \"圭\", promoted_alias_name: null, },\n      { key: \"L\", name: \"香\", alias_name: null, promoted_name: \"杏\", promoted_alias_name: null, },\n      { key: \"P\", name: \"歩\", alias_name: null, promoted_name: \"と\", promoted_alias_name: null, },\n    ]\n  }\n\n  static lookup(key) {\n    if (typeof key === \"string\") {\n      key = key.toUpperCase()\n    }\n    return super.lookup(key)\n  }\n\n  static kif_lookup(key) {\n    return this.values.find((e) => [e.name, e.alias_name].includes(key))\n  }\n\n  static kif_promoted_lookup(key) {\n    return this.values.find((e) => [e.promoted_name, e.promoted_alias_name].includes(key))\n  }\n\n  get promoted_name() {\n    return this.attributes.promoted_name\n  }\n\n  get css_class_list() {\n    return [\"piece_name\", `piece_${this.key}`]\n  }\n}\n\nexport { Piece }\n\nif (process.argv[1] === __filename) {\n  console.log(Piece.fetch(\"K\"))\n  console.log(Piece.fetch(\"K\"))\n  console.log(Piece.lookup(\"\"))\n  console.log(Piece.values)\n  console.log(Piece.values_map.get(\"K\"))\n  console.log(Piece.fetch(\"K\").key)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/piece.js","import _ from \"lodash\"\n\nimport { Piece } from \"./piece\"\nimport { Point } from \"./point\"\nimport { Mediator } from \"./mediator\"\nimport { Location } from \"./location\"\nimport { Board } from \"./board\"\n\nclass SfenSerializer {\n  constructor(mediator) {\n    this.mediator = mediator\n  }\n\n  get to_s() {\n    const parts = []\n    parts.push(this.to_baord_sfen)\n    parts.push(this.mediator.location_next.key[0])\n    parts.push(this.to_hold_pieces)\n    parts.push(this.mediator.normalized_turn + 1)\n    return parts.join(\" \")\n  }\n\n  get to_baord_sfen() {\n    const rows = []\n    _.times(Board.dimension, (y) => {\n      let str = \"\"\n      let space = 0\n      _.times(Board.dimension, (x) => {\n        const point = Point.fetch([x, y])\n        const battler = this.mediator.current_field.get(point.key)\n        if (battler === undefined) {\n          space++\n        } else {\n          if (space >= 1) {\n            str += space\n            space = 0\n          }\n          if (battler.promoted) {\n            str += \"+\"\n          }\n          let key = battler.piece.key\n          if (battler.location.key === \"white\") {\n            key = key.toLowerCase()\n          }\n          str += key\n        }\n      })\n      if (space >= 1) {\n        str += space\n      }\n      rows.push(str)\n    })\n    return rows.join(\"/\")\n  }\n\n  get to_hold_pieces() {\n    let str = Location.values.map((location_info) => {\n      const hold_pieces = this.mediator.hold_pieces.get(location_info.key)\n      const values = Piece.values.map((e) => {\n        let count = hold_pieces.get(e.key) || 0\n        let str = \"\"\n        if (count === 0) {\n          return null\n        }\n        if (count >= 2) {\n          str += count\n        }\n        let key = e.key\n        if (location_info.key === \"white\") {\n          key = key.toLowerCase()\n        } else {\n          key = key.toUpperCase()\n        }\n        str += key\n        return str\n      })\n      return _.compact(values).join(\"\")\n    }).join(\"\")\n\n    if (_.isEmpty(str)) {\n      str = \"-\"\n    }\n\n    return str\n  }\n}\n\nexport { SfenSerializer }\n\nif (process.argv[1] === __filename) {\n  const mediator = new Mediator()\n  mediator.kifu_body = \"position sfen +lnsgkgsnl/1r5b1/ppppppppp/9/9/9/PPPPPPPPP/1B5R1/LNSGKGSNL b S2s 1 moves 7i6h S*2d\"\n  mediator.current_turn = 1\n  mediator.run()\n  const sfen_serializer = new SfenSerializer(mediator)\n  console.log(sfen_serializer.to_s)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/sfen_serializer.js","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"shogi-player\",class:[(\"theme-\" + _vm.theme), {debug: _vm.debug_mode}]},[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.error_message !== null),expression:\"error_message !== null\"}]},[_c('div',{staticClass:\"columns\"},[_c('div',{staticClass:\"column\"},[_c('article',{staticClass:\"message is-danger has-text-left\"},[_vm._m(0),_vm._v(\" \"),_c('div',{staticClass:\"message-body\"},[_c('p',[_vm._v(_vm._s(_vm.error_message)+\">\")])])])])])]),_vm._v(\" \"),(!_vm.mediator)?[_c('i',{staticClass:\"fas fa-spinner fa-pulse\"})]:_vm._e(),_vm._v(\" \"),(_vm.mediator)?[_c('div',{staticClass:\"turn_editor\"},[(!_vm.turn_edit)?[_c('span',{staticClass:\"turn_edit_text\",on:{\"click\":_vm.turn_edit_run}},[_vm._v(_vm._s(_vm.mediator.current_turn_label))])]:_vm._e(),_vm._v(\" \"),(_vm.turn_edit)?[_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.turn_edit_value),expression:\"turn_edit_value\",modifiers:{\"number\":true}}],ref:\"turn_edit_input\",staticClass:\"turn_edit_input\",attrs:{\"type\":\"number\"},domProps:{\"value\":(_vm.turn_edit_value)},on:{\"blur\":[function($event){_vm.turn_edit = false},function($event){_vm.$forceUpdate()}],\"input\":function($event){if($event.target.composing){ return; }_vm.turn_edit_value=_vm._n($event.target.value)}}})]:_vm._e()],2),_vm._v(\" \"),_c('div',{staticClass:\"board_container board_turn\",class:{turned: _vm.board_turn}},[_c('PieceStand',{attrs:{\"location_key\":'white'}}),_vm._v(\" \"),_c('div',{staticClass:\"flex_item board_wrap\"},[_c('div',{staticClass:\"overlay_navi previous\",on:{\"click\":function($event){$event.stopPropagation();_vm.navi_relative_move(-1, $event)}}}),_vm._v(\" \"),_c('div',{staticClass:\"overlay_navi next\",on:{\"click\":function($event){$event.stopPropagation();_vm.navi_relative_move(+1, $event)}}}),_vm._v(\" \"),_c('div',{staticClass:\"overlay_navi board_turn_area\",on:{\"click\":_vm.board_turn_run}}),_vm._v(\" \"),_c('table',{staticClass:\"board\"},_vm._l((_vm.mediator.dimension),function(y){return _c('tr',[_vm._l((_vm.mediator.dimension),function(x){return [_c('td',{staticClass:\"td_cell\",class:_vm.mediator.cell_class(x -1, y - 1)},[_c('span',{staticClass:\"span_cell\",class:_vm.mediator.cell_class(x - 1, y - 1)},[_vm._v(\"\\n                  \"+_vm._s(_vm.mediator.cell_view(x - 1, y - 1))+\"\\n                \")])])]})],2)}))]),_vm._v(\" \"),_c('PieceStand',{attrs:{\"location_key\":'black'}})],1),_vm._v(\" \"),(_vm.controller_show)?[_c('div',{staticClass:\"controller_block buttons has-addons is-centered\"},[_c('button',{ref:\"first\",staticClass:\"button first\",on:{\"click\":function($event){$event.stopPropagation();_vm.move_to_first($event)}}},[_vm._v(\"|◀\")]),_vm._v(\" \"),_c('button',{ref:\"previous\",staticClass:\"button previous\",on:{\"click\":function($event){$event.stopPropagation();_vm.relative_move(-1, $event)}}},[_vm._v(\"◀\")]),_vm._v(\" \"),_c('button',{ref:\"next\",staticClass:\"button next\",on:{\"click\":function($event){$event.stopPropagation();_vm.relative_move(+1, $event)}}},[_vm._v(\"▶\")]),_vm._v(\" \"),_c('button',{ref:\"last\",staticClass:\"button last\",on:{\"click\":function($event){$event.stopPropagation();_vm.move_to_last($event)}}},[_vm._v(\"▶|\")]),_vm._v(\" \"),_c('button',{staticClass:\"button board_turn\",on:{\"click\":function($event){$event.stopPropagation();_vm.board_turn_run($event)}}},[_vm._v(_vm._s(_vm.board_turn ? '↺' : '↻'))])])]:_vm._e(),_vm._v(\" \"),(_vm.slider_show)?[_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.current_turn),expression:\"current_turn\",modifiers:{\"number\":true}}],ref:\"slider\",staticClass:\"slider\",attrs:{\"type\":\"range\",\"min\":_vm.mediator.any_parser.turn_min,\"max\":_vm.mediator.any_parser.turn_max},domProps:{\"value\":(_vm.current_turn)},on:{\"__r\":function($event){_vm.current_turn=_vm._n($event.target.value)},\"blur\":function($event){_vm.$forceUpdate()}}})]:_vm._e(),_vm._v(\" \"),(_vm.mediator.any_parser.comments_pack)?_c('div',{staticClass:\"comment_area\"},[(_vm.mediator.current_comments)?[_c('div',{staticClass:\"columns\"},[_c('div',{staticClass:\"column is-three-fifths is-offset-one-fifth\"},[_c('div',{staticClass:\"content has-text-left\"},[_vm._l((_vm.mediator.current_comments),function(str){return [(_vm._.isEmpty(str))?[_c('br')]:[_c('div',{domProps:{\"innerHTML\":_vm._s(_vm.mediator.auto_link(str))}})]]})],2)])])]:_vm._e()],2):_vm._e(),_vm._v(\" \"),(_vm.sfen_show)?_c('p',{staticClass:\"is-size-7 has-text-grey\"},[_vm._v(\"\\n      \"+_vm._s(_vm.mediator.to_sfen)+\"\\n    \")]):_vm._e()]:_vm._e(),_vm._v(\" \"),(_vm.debug_mode)?[(_vm.mediator)?[_c('p',[_vm._v(_vm._s(_vm.mediator.hold_pieces))]),_vm._v(\" \"),_c('p',[_vm._v(\"次の手番:\"+_vm._s(_vm.mediator.location_next.key))]),_vm._v(\" \"),_c('p',[_vm._v(\"Sfen:\"+_vm._s(_vm.mediator.to_sfen))])]:_vm._e(),_vm._v(\" \"),_c('p',[_vm._v(\"read_counter: \"+_vm._s(_vm.read_counter))])]:_vm._e()],2)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"message-header\"},[_c('p',[_vm._v(\"ERROR\")])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-55727709\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/ShogiPlayer.vue\n// module id = ZjWl\n// module chunks = 1 2","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"flex_item piece_stand\",class:[(\"location_\" + (_vm.location.key)), _vm.$parent.env, {turn_active: _vm.$parent.mediator.location_next.key === _vm.location.key}]},[_c('ul',[_c('li',{staticClass:\"location_mark\"},[_vm._v(_vm._s(_vm.location.name))]),_vm._v(\" \"),_vm._l((_vm.$parent.mediator.realized_hold_pieces_of(_vm.location.key)),function(ref){\nvar piece = ref[0];\nvar count = ref[1];\nreturn _c('li',[_c('span',{class:piece.css_class_list},[_vm._v(_vm._s(piece.name))]),_vm._v(\" \"),(count >= 2)?_c('span',{staticClass:\"piece_count\"},[_vm._v(_vm._s(count))]):_vm._e()])})],2)])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-f8d796fa\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/PieceStand.vue\n// module id = ZtI5\n// module chunks = 1 2","var normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./PieceStand.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./PieceStand.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-f8d796fa\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./PieceStand.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = null\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/PieceStand.vue\n// module id = a83v\n// module chunks = 1 2","class Board {\n  static get dimension() {\n    return 9\n  }\n}\n\nexport { Board }\n\nif (process.argv[1] === __filename) {\n  console.log(Board.dimension)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/board.js","import { MemoryRecord } from \"./memory_record\"\n\nclass Location extends MemoryRecord {\n  static get define() {\n    return [\n      { key: \"black\", name: '☗', },\n      { key: \"white\", name: '☖', },\n    ]\n  }\n}\n\nexport { Location }\n\nif (process.argv[1] === __filename) {\n  console.log(Location.fetch(\"black\"))\n\n  Location.values.map((e) => {\n    console.log(e)\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/location.js","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-55727709\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"indentedSyntax\\\":true,\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./ShogiPlayer.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ShogiPlayer.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ShogiPlayer.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-55727709\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./ShogiPlayer.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/ShogiPlayer.vue\n// module id = oS6v\n// module chunks = 1 2","import XRegExp from \"xregexp\"\nimport assert from \"minimalistic-assert\"\n\nimport { ParserBase } from \"./parser_base\"\nimport { Piece } from \"./piece\"\nimport { Point } from \"./point\"\nimport { Location } from \"./location\"\nimport { SfenParser } from \"./sfen_parser\"\n\nclass KifParser extends ParserBase {\n  get field() {\n    const sfen_parser = new SfenParser()\n    sfen_parser.kifu_body = \"position startpos\" // TODO: sfen形式の値のテーブルを持って駒落ちに対応する\n    sfen_parser.parse()\n    return sfen_parser.field\n  }\n\n  get location_base() {\n    let key = null\n    const value = this.header[\"手合割\"] || \"平手\"\n    if (value === \"平手\") {\n      key = \"black\"\n    } else {\n      key = \"white\"\n    }\n    return Location.fetch(key)\n  }\n\n  parse() {\n    this.move_infos = []\n    this.comments_pack = {}\n    let before_point = null\n\n    this.kifu_body.split(/\\n/).forEach((line) => {\n      const md = XRegExp.exec(line, this.__kif_format_move_regexp)\n      if (md) {\n        const attrs = {}\n        attrs[\"location\"] = this.location_by_offset(Number(md[\"number\"]) - 1)\n        if (md[\"origin_point\"]) {\n          attrs[\"origin_point\"] = Point.fetch(md[\"origin_point\"])\n        }\n        assert(md[\"to\"] || md[\"same\"])\n        if (md[\"to\"]) {\n          attrs[\"point\"] = Point.fetch(md[\"to\"])\n          before_point = attrs[\"point\"]\n        } else {\n          assert(md[\"same\"])\n          assert(before_point)\n          attrs[\"point\"] = before_point\n        }\n        if (md[\"motion\"] === \"成\") {\n          attrs[\"promoted_trigger\"] = true\n        }\n        if (md[\"motion\"] === \"打\") {\n          attrs[\"stroke_piece\"] = Piece.kif_lookup(md[\"piece\"])\n        }\n        this.move_infos.push(attrs)\n      } else {\n        const md = XRegExp.exec(line, XRegExp(\"^\\\\*(?<comment>.*)\"))\n        if (md) {\n          const index = this.move_infos.length\n          this.comments_pack[index] = this.comments_pack[index] || []\n          this.comments_pack[index].push(md[\"comment\"])\n        }\n      }\n    })\n  }\n\n  set move_infos(v) {\n    this._move_infos = v\n  }\n\n  get move_infos() {\n    return this._move_infos || {}\n  }\n\n  set comments_pack(v) {\n    this._comments_pack = v\n  }\n\n  get comments_pack() {\n    return this._comments_pack || {}\n  }\n\n  get __kif_format_move_regexp() {\n    return XRegExp(`\n        ^\\\\s*(?<number>\\\\d+)\\\\s+\n        (?<to>[１-９1-9一二三四五六七八九]{2})?\n        (?<same>同)?\\\\s*\n        (?<piece>成[銀桂香]|[王玉金銀全桂圭香杏角馬飛龍竜歩と])\n        (?<suffix>[左右直]?[寄引上]?)\n        (?<motion>不?成|打|合|生)?\n        (\\\\((?<origin_point>\\\\d{2})\\\\))? # KIFフォーマットの移動元用\n      `, 'xm')\n  }\n}\n\nexport { KifParser }\n\nif (process.argv[1] === __filename) {\n  const kif_parser = new KifParser()\n//   kif_parser.kifu_body = `\n// # ----  Kifu for Windows V6.26 棋譜ファイル  ----\n// key：value\n// 手数----指手---------消費時間--\n// *コメント0a\n// *コメント0b\n//    1 ７六歩(77)   ( 0:00/00:00:00)\n// *コメント1a\n// *コメント1b\n//    2 ３四歩(33)   ( 0:00/00:00:00)\n//    3 投了         ( 0:00/00:00:00)\n// `\n\n  kif_parser.kifu_body = `\n   1 ２六歩(27)   ( 0:16/00:00:16)\n   2 ３四歩(33)   ( 0:22/00:00:22)\n   3 ７六歩(77)   ( 0:06/00:00:22)\n   4 ８四歩(83)   ( 0:13/00:00:35)\n   5 ２五歩(26)   ( 0:09/00:00:31)\n   6 ８五歩(84)   ( 0:16/00:00:51)\n   7 ７八金(69)   ( 0:04/00:00:35)\n   8 ３二金(41)   ( 0:09/00:01:00)\n   9 ２四歩(25)   ( 0:04/00:00:39)\n  10 同 歩(23)    ( 0:10/00:01:10)\n`\n  kif_parser.parse()\n  // console.log(kif_parser.field)\n  // console.log(kif_parser.location_base)\n  // console.log(kif_parser.hold_pieces)\n  console.log(kif_parser.move_infos)\n  console.log(kif_parser.comments_pack)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/kif_parser.js","<template>\n<div class=\"flex_item piece_stand\" :class=\"[`location_${location.key}`, $parent.env, {turn_active: $parent.mediator.location_next.key === location.key}]\">\n  <ul>\n    <li class=\"location_mark\">{{location.name}}</li>\n    <li v-for=\"[piece, count] in $parent.mediator.realized_hold_pieces_of(location.key)\">\n      <span :class=\"piece.css_class_list\">{{piece.name}}</span>\n      <span v-if=\"count >= 2\" class=\"piece_count\">{{count}}</span>\n    </li>\n  </ul>\n</div>\n</template>\n\n<script>\nimport { Location } from \"../location\"\n\nexport default {\n  props: {\n    location_key: { required: true },\n  },\n\n  computed: {\n    location: function () {\n      return Location.fetch(this.location_key)\n    },\n  },\n}\n</script>\n\n\n\n// WEBPACK FOOTER //\n// src/components/PieceStand.vue","import XRegExp from \"xregexp\"\n\nimport { ParserBase } from \"./parser_base\"\nimport { Piece } from \"./piece\"\nimport { Point } from \"./point\"\nimport { Battler } from \"./battler\"\nimport { Location } from \"./location\"\n\nclass SfenParser extends ParserBase {\n  parse() {\n    this.kifu_body = this.kifu_body.replace(/startpos/, \"sfen lnsgkgsnl/1r5b1/ppppppppp/9/9/9/PPPPPPPPP/1B5R1/LNSGKGSNL b - 1\")\n    const regex = XRegExp(\"sfen\\\\s+(?<sfen>\\\\S+)\\\\s+(?<b_or_w>\\\\S+)\\\\s+(?<hold_pieces>\\\\S+)\\\\s+(?<turn_counter_next>\\\\d+)(\\\\s+moves\\\\s+(?<moves>.*))?\")\n    this.attributes = XRegExp.exec(this.kifu_body, regex)\n    if (process.env.NODE_ENV === \"deveopment\") {\n      console.log(this.attributes)\n    }\n  }\n\n  get field() {\n    let field = new Map()\n    this.attributes[\"sfen\"].split(\"/\").forEach((e, y) => {\n      let x = 0\n      XRegExp.forEach(e, XRegExp(\"(?<promoted>\\\\+?)(?<piece>\\\\S)\"), (m, i) => {\n        if (/\\d+/.test(m.piece)) {\n          x += Number(m.piece)\n        } else {\n          const battler = new Battler({\n            point: new Point([x, y]),\n            piece: Piece.fetch(m.piece),\n            promoted: (m.promoted === \"+\"),\n            location: this.__location_by_upper_or_lower_case(m.piece),\n          })\n          field.set(battler.point.key, battler)\n          x++\n        }\n      })\n    })\n    return field\n  }\n\n  get location_base() {\n    let key = null\n    if (this.attributes[\"b_or_w\"] === \"b\") {\n      key = \"black\"\n    } else {\n      key = \"white\"\n    }\n    return Location.fetch(key)\n  }\n\n  get hold_pieces() {\n    const _hold_pieces = super.hold_pieces\n    if (this.attributes[\"hold_pieces\"] !== \"-\") {\n      XRegExp.forEach(this.attributes[\"hold_pieces\"], XRegExp(\"(?<count>\\\\d+)?(?<piece_char>\\\\S)\"), (md, i) => {\n        const piece = Piece.fetch(md.piece_char)\n        let count = Number(md.count || 1)\n        const location = this.__location_by_upper_or_lower_case(md.piece_char)\n        count += _hold_pieces.get(location.key).get(piece.key) || 0\n        _hold_pieces.get(location.key).set(piece.key, count)\n      })\n    }\n    return _hold_pieces\n  }\n\n  get turn_min() {\n    return Number(this.attributes[\"turn_counter_next\"]) - 1\n  }\n\n  get komaochi_p() {\n    return (this.turn_min % 2) === 0 && this.location_base.key === \"white\"\n  }\n\n  get move_infos() {\n    if (this.attributes[\"moves\"] === undefined) {\n      return []\n    }\n    return this.attributes[\"moves\"].split(/\\s+/).map((e, i) => {\n      const attrs = {}\n      // if (true) {\n      //   attrs[\"scene_index\"] = this.turn_min + i\n      //   attrs[\"scene_offsert\"] = i\n      // }\n      attrs[\"location\"] = this.location_by_offset(i)\n      const md = XRegExp.exec(e, XRegExp(\"(?<origin_x>\\\\S)(?<origin_y>\\\\S)(?<pos_x>\\\\S)(?<pos_y>\\\\S)(?<promoted>\\\\+?)?\"))\n      attrs[\"promoted_trigger\"] = (md.promoted === \"+\")\n      if (md[\"origin_y\"] === \"*\") {\n        attrs[\"stroke_piece\"] = Piece.fetch(md[\"origin_x\"])\n      } else {\n        attrs[\"origin_point\"] = Point.fetch(`${md[\"origin_x\"]}${md[\"origin_y\"]}`)\n      }\n      attrs[\"point\"] = Point.fetch(`${md[\"pos_x\"]}${md[\"pos_y\"]}`)\n      return attrs\n    })\n  }\n\n  __location_by_upper_or_lower_case(v) {\n    let key = null\n    if (/[A-Z]/.test(v)) {\n      key = \"black\"\n    } else {\n      key = \"white\"\n    }\n    return Location.fetch(key)\n  }\n}\n\nexport { SfenParser }\n\nif (process.argv[1] === __filename) {\n  const sfen_parser = new SfenParser()\n  sfen_parser.kifu_body = \"position sfen +lnsgkgsnl/1r5b1/ppppppppp/9/9/9/PPPPPPPPP/1B5R1/LNSGKGSNL b S2s 1 moves 7i6h S*2d\"\n  sfen_parser.parse()\n  console.log(sfen_parser.field)\n  console.log(sfen_parser.location_base.key)\n  console.log(sfen_parser.hold_pieces)\n  console.log(sfen_parser.move_infos)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/sfen_parser.js"],"sourceRoot":""}